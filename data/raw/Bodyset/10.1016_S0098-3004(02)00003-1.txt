Spatial variables in the geosciences often display different patterns of variability at different spatial scales. When these variables are cross-correlated, the magnitude of the cross-correlation may differ at the different scales of spatial variability. This scale-dependent spatial variability and cross-correlation can be investigated by geostatistical factor analysis, which consists of four steps:
                  
                     
                        
                           •
                           Semi-variogram analysis. Semi-variograms and cross-semi-variograms are estimated from the experimental data and are used to identify the scales of variability. The different scales of variability can be interpreted and can often be linked to physical causes.
                        
                        
                           •
                           Fitting a model to the set of semi-variograms and cross-semi-variograms. A consistent model, such as the linear model of coregionalization, is fitted to the set of experimental semi-variograms and cross-semi-variograms.
                        
                        
                           •
                           Factorial cokriging is used to estimate an individual factor, an individual component or a combination of components of any of the coregionalized variables.
                        
                        
                           •
                           Interpretation of the estimated factor or component.
                        
                     
The purpose of this paper is to describe programs for performing the second and third steps. Programs are also provided for automatic fitting of a linear coregionalization model and for estimating, by factorial cokriging, a single factor, a single component or a combination of components. Although programs for factorial kriging and programs for cokriging can be found elsewhere the software described here (FACTOR2D) provides a complete solution by combining factorial cokriging with a program for fitting a linear coregionalization model (LCMFIT2). The use and performance of the programs is demonstrated on simulated and real case studies.Semi-variogram analysis. Semi-variograms and cross-semi-variograms are estimated from the experimental data and are used to identify the scales of variability. The different scales of variability can be interpreted and can often be linked to physical causes. Fitting a model to the set of semi-variograms and cross-semi-variograms. A consistent model, such as the linear model of coregionalization, is fitted to the set of experimental semi-variograms and cross-semi-variograms. Factorial cokriging is used to estimate an individual factor, an individual component or a combination of components of any of the coregionalized variables. Interpretation of the estimated factor or component. In earth science applications it is commonplace for a number of regionalized variables to be sampled over the same area or volume. An example is the wireline logging of variables along boreholes or wells. Two frequently observed features are correlations among the variables and scale-dependent spatial variability. The combination of these two features means that the regionalized variables can have different degrees of correlation at different spatial scales. Spatial scales of variation in our context are related to different ranges observed in the experimental semi-variogram and are not related to the support of the experimental data. In the work described here the supports of data and estimation target are assumed to be points (or quasi-points). We provide a brief review of the theory of factorial cokriging; a more extensive treatment may be found elsewhere ( The scales of variation are identified by estimating the semi-variograms and cross-semi-variograms of the regionalized variables. The experimental semi-variograms and cross-semi-variograms are modelled with nested structures, with each structure representing a particular scale of variation, e.g. a nugget effect, a short-range structure and a long-range structure. Permissible models, such as the linear coregionalization model ( Or, in matrix notation: The estimator is unbiased as a consequence of the conditions imposed on the weights and the factor has zero mean by construction. In the same way, an unbiased estimate of a spatial component may be obtained by cokriging: Minimization of the estimation variance in (20), subject to the unbiased conditions, gives the cokriging system: Alternatively, we may wish to estimate a linear combination of components, e.g. the first  Each semi-variogram and cross-semi-variogram is represented as a sum of the same elementary semi-variogram models If an elementary model is not present for some semi-variogram or cross-semi-variogram, its coefficient is set to zero. By construction, all cross-covariances are symmetric. A necessary, but not sufficient, condition for the coefficients is Fitting a regionalization model comprises the following steps: All direct semi-variograms and cross-semi-variograms are estimated for the same number of lags and the same lag distances The number and types of elementary models and their ranges are postulated. The sills (coregionalization matrix) are fitted by trial and error or by using some optimization technique. The goodness-of-fit criterion is the Euclidean norm (weighted sum of squares, WSS) of all terms of the error matrix The idea is to minimize the criterion by optimizing one The constrained solution is then FACTOR2D is a computer program written in ANSI standard FORTRAN 77 for factorial cokriging. The program includes the following options: Estimation, by cokriging, of a spatial factor at a given scale of variation. Estimation, by cokriging, of a spatial component for a given variable. Estimation, by cokriging, of the first Estimation, by cokriging, of the last The estimation is performed on a regular grid defined by the user, or in the case of cokriging the nugget effect factor or nugget effect component, on the experimental locations. FACTOR2D is the main program and calls nine external subroutines ( EIGENJ: subroutine for calculating the eigenvalues and eigenvectors of a symmetric matrix (after NEIGHB2D: determines the data within the neighbourhood of the location to be estimated. CLA: routine for sorting data in increasing order. FCOKRI2D: sets up the cokriging system and calculates the estimation variance. COREGIO: calculates the covariance value between two locations. MATINV: calculates the inverse of a matrix using LUDCMP and LUBKSB. LUDCMP: calculates the LU decomposition of a symmetric matrix ( LUBKSB: calculates the inverse of a triangular matrix by back-substitution ( MATPROC: calculates the product of two matrices. The input to FACTOR2D is a parameter file, an example of which is given in The first line specifies the number of variables The following line contains a flag value The following lines specify the The value on the following line specifies the type of cokriging required: estimation of a single factor at a given scale, estimation of a single spatial component for a given variable, estimation of the first estimation of the last The next four lines specify the search strategy for cokriging. The first line specifies the search ellipse with longer axis, anisotropy ratio and anisotropy angle. These parameters have the same requirements as the equivalent parameters for defining a covariance structure. If the anisotropy ratio is 1 the search area is a circle. For a given estimation location the program will consider only the experimental data inside the search ellipse centred on that location. The following line specifies the minimum number of neighbours within the search ellipse for cokriging to be performed at a given location. If the number of neighbours for a given location is less than specified, cokriging is not performed and an warning value of −999.25 is assigned to the estimate and to the estimation variance for that location. The next line is the maximum number of neighbours to be used for cokriging. The maximum value has been set to 100. In the next line quadrant search is signified by a value of 1, otherwise a value of 0 is entered. The next three lines specify the estimation grid with the origin of the grid in the The next line specifies the name of the output file to which the estimates will be written. The following line specifies the output file for the estimation error (square root of the estimation variance). In the final line, screen displays of intermediate results are requested by entering a value of 1 (note that this option will slow the cokriging process); if screen displays are not required, enter any value other than 1. The program creates an output file, MATRIXA.DAT, which contains, for each spatial scale, the egivenvalues, the percentage of variance explained by each factor, the cumulative percentage variance, the eigenvectors, the coefficients of correlation between the factors and the original variables and the coregionalization coefficient matrices The program PREFAC.FOR is provided for interactive entry of parameter file values. Alternatively, any editing or word processing program can be used to create a parameter file or to modify an existing parameter file. The coregionalization matrices must be symmetric and positive definite. The program checks for these properties by verifying that none of the eigenvalues of the coregionalization matrices are negative. If a negative eigenvalue is found, the program will display a warning and terminate execution. It should be noted that the output from the program LCMFIT2 comprises the coregionalization matrices, so the coregionalization covariances could be specified by inserting the output file in the parameter file. The program then reads in the experimental data for the variables from their respective files and begins factorial cokriging with a double loop for the LCMFIT2 is the main program for fitting linear coregionalization models. It calls the external subroutines EIGENJ and MATPROC. The program fits the linear coregionalization model given in The first line specifies the number of variables The following line specifies the number of The following line contain the In the next line the parameter The next lines specify the The penultimate line specifies the convergence value, which should be a small positive number. Convergence is deemed to have been achieved when the decrease in WSS from one iteration to the next is less than the convergence value. The final line specifies the name of the output file that will contain the results. The program PRELCM.FOR is provided for interactive entry of parameter file values. Alternatively, any editing or word processing program can be used to create a parameter file or to modify an existing parameter file. The current matrix dimensions in the program FACTOR2D impose the following limitations: maximum number of variables: 10 maximum number of experimental data: 14500 maximum number of structures: 5 maximum number of variables: 10 maximum number of structures: 5 maximum number of directions: 8 maximum number of lags: 300 Any of these numbers can be increased by modifying the corresponding matrices and calls to subroutines. Two examples, one with simulated data and the other with real data, are given to demonstrate the implementation of, and output from, the programs. The advantage of the simulated case study is that the real underlying factors for each structure and the spatial components for each variable are known. Three variables have been simulated on a 128×128 square grid with a linear model of coregionalization that consists of two different nested scales of variability. The first scale of variability is a structure of short range (equal to 6 units) with a spherical isotropic covariance model and coregionalization matrix: From each of the simulated random fields, 400 locations where selected at random and at each location the three values, one for each variable, were used as the experimental observations. The experimental, directional variograms and the models fitted by LCMFIT2 are shown in The estimated long-range spatial components for the three variables are shown in The second example is the Swiss Jura data set given by FACTOR2D provides an efficient way of estimating spatial factors, components, or combinations of components for a given coregionalized variable. LCMFIT2 is an efficient program for fitting the coregionalization model for a linear coregionalization. The use of both programs provides a complete solution for factorial cokriging analysis, but the interpretation of spatial structures and the estimated factor or components will be specific to each case study. FACTOR3D, a 3D version of the program, is public domain and available on request from the authors. The work reported in this paper was funded by EPSRC (Engineering and Physical Sciences Research Council) Grant number GR/M72944. The authors wish to record their thanks to the reviewers of this paper for providing constructive comments that have contributed to an improvement in the published version.