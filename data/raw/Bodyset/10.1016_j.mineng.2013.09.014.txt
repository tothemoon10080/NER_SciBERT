Ore characterisation is important in order to understand the quality of ores and their behaviour during downstream processing. Many significant ore characteristics can only be determined through the use of various imaging techniques. Optical Image Analysis (OIA) is one such technique and is particularly attractive for many applications due to its low cost and high resolution. However OIA also has some limitations, one of which is the difficulty with discriminating non-opaque minerals. Some non-opaque minerals, such as quartz, are typical gangue minerals in certain types of iron ores. Even though in many cases quartz particles can be easily seen and attributed by mineralogists in polished sections, their automated discrimination has always been an issue, the reasons for which are discussed in this article. The ability to automatically discriminate quartz and other non-opaque minerals would significantly increase the value of OIA for the mineral industry.
                  This paper describes a novel method of discriminating non-opaque minerals in the sample by their optical relief, which results in visible borders between the mineral and the epoxy resin mounting medium. An algorithm for such discrimination that has been developed for the CSIRO Mineral4/Recognition4 OIA software package is described. The algorithm is based on dynamic thresholding of the image with subsequent cleanup and enhancement to reliably determine borders between non-opaque particles and epoxy and on subsequent attribution of image areas created by these borders to either the non-opaque mineral or the epoxy resin. Further, this article discusses difficulties that may arise when applying this algorithm due to sample peculiarities and describes algorithm enhancements incorporated in Mineral4 in order to overcome these issues. The resulting software is capable of reliably discriminating non-opaque minerals in a variety of samples, including iron and manganese ores.Extensive mineralogical and textural characterisation of different ores is a key element in the development of downstream mineral processing routines in order to understand and attempt to predict an ore’s behaviour during mineral processing ( One particular example of problematic mineral identification when using OIA is the discrimination of non-opaque minerals ( A typical example of such a non-opaque mineral, a gangue mineral particularly abundant in iron ores of certain types, is quartz. The very limited ability of traditional threshold-based OIA to automatically identify quartz has been one of the biggest problems in the application of OIA to iron ore characterisation for a long period of time. Several approaches, as described further, have been suggested to overcome this restriction. Some of those approaches can provide good results in certain cases, however they often require complex sample preparation and image acquisition techniques and are not applicable to the whole range of possible tasks. For example, thin section imaging ( There also have been attempts to improve quartz identification by making simple changes to polished block preparation, such as selecting the most suitable brand of epoxy resin and/or impregnating it with dyes, but they have not produced acceptable results to date ( It is particularly important to note that in many cases OIA-based mineral identification can be more accurate than that performed by a mineralogist because, although the human eye is very efficient at seeing relative differences between greyscale or colour reflectivities, it is not as adept as OIA in determining their absolute values. It leads to the well known optical phenomenon where an object viewed on a black background is perceived as being brighter than another object viewed on a white background, while in fact it is darker. During mineral identification by a mineralogist, this phenomenon can result in the different identification of the same grains of minerals, depending on whether they are embedded in lighter or darker matrices. Although experienced mineralogists can make adjustments during identification, based upon their knowledge of typical mineral textures and associations, it is not unusual to see them disagreeing about the particular features of a given sample. OIA methods that are based on the absolute reflectivities of minerals rather than human perception of reflectivities are free from such bias. However in the case of quartz, OIA often fails to recognise particle areas that mineralogists have no problem in identifying. This is due to the ability of the trained human eye and brain to recognise familiar patterns and come to conclusions on their broader meaning.  From the images in The main idea underpinning the method of automated non-opaque mineral discrimination described in this article is, in fact, fully based on the observations made in the previous paragraph. The authors suggest that if it is possible to fully identify the border between a non-opaque mineral and epoxy and to establish the spatial relationships of the “epoxy-like” areas separated by such borders with each other and other objects in the section, a software algorithm should be able to conclude which areas correspond to epoxy and which correspond to non-opaque particles. In the simplistic case where there are no breaks in the boundaries between particles and epoxy resin and particles are (a) not touching each other and (b) the maximum size of non-opaque particles in the sample is known in advance and is also significantly smaller than the image size (and therefore the size of the epoxy areas) distinguishing between non-opaque minerals and epoxy can be performed merely on the basis of differences in area sizes. As optical image analysis of ore fines in downstream process performance studies is typically performed over fractions of known particle size, the condition (b) can be easily met. Unfortunately it is very difficult to fully avoid particles touching each other during epoxy block preparation. Later in the article we will show what effect touching particles may have on non-opaque mineral recognition. Importantly, once the particle borders are determined, the majority of non-opaque particle areas can be identified relatively easily. This leads us to the significant question of whether it is possible to reliably identify the borders between epoxy resin and non-opaque minerals, keeping in mind that a border’s visibility depends heavily on many factors and under certain circumstances, in particular – when the cross-section of the polished block is at right angle to the immersed surface of quartz particle, can be near zero. Fortunately, the visibility of the border between the mounting medium and a known non-opaque mineral is something that can be partially controlled during sample preparation by choosing epoxy with an advantageous refractive index. Due to the well-known effect of optical relief ( During the study described in the present article it was also attempted to further improve the visibility of particle borders by over-polishing the epoxy-mounted samples. It was hoped that over-polishing could improve border visibility in two ways. Firstly, it was expected that the actual border between the epoxy and quartz (that is much harder than the epoxy and therefore should be subject to less removal during over-polishing) would become more visible; secondly, bringing the surface of the quartz further above the level of the epoxy resin, and therefore more out of focus when the microscope is focused on the epoxy surface, could produce the Becke line effect along the particle border ( A relief-based border-identification technique for quartz discrimination in epoxy-mounted samples was first applied to the OIA of manganese ore fines in 2010. The analysis was performed using the Mineral3/Recognition3 software package developed by CSIRO (  Although the results obtained for the first manganese ore samples were quite promising, subsequent tests with other manganese ore samples, and, more importantly, iron ore samples, have shown a number of issues that can be encountered during border-based quartz discrimination. In order to overcome those issues a significant number of algorithm enhancements have been developed and tested. These enhancements will be described later in the algorithm description section of this paper, however, in order to better understand the reason for some required algorithm improvements, it is important to firstly give examples of such issues. Most of the issues have little impact on samples that are: thoroughly wet-sized, so no adhering or non-adhering ultrafines (“noise”) are present, have well-liberated non-opaque material, have a relatively low particle-to-epoxy area ratio and have a low percentage of touching particles. Unfortunately natural samples do not often satisfy those conditions. First of all, even if border identification is of acceptable quality, touching particles, especially non-opaque ones, can produce a pattern that makes it more difficult for a mineralogist to distinguish between non-opaque material and epoxy resin, and even harder for a software algorithm. The second issue is the quality of particle border recognition. Quite often the border is simply not clear enough, due to the noise in the image (e.g. the presence of adhering ultrafines) and other factors, or the border is optically discontinuous, or there are areas that are hard to identify, such as those marked with A and B in The false connections mentioned above are not necessarily produced by border improvement as touching opaque particles may also create isolated epoxy areas. The same applies to particles that do not actually touch each other but the epoxy between them is irregular enough (e.g. because the particle surface just underneath the epoxy is partially visible) to produce artefacts during border identification. One of the problems with discrimination of non-opaque minerals is the fact that they are not “invisible” as such. What is very often seen in the image where they are located is the out-of-focus underlying material. If there is a grain of a non-opaque mineral, which is relatively small or which does not have a very substantial cross-section, present locked within some other opaque mineral, then the result may be that the texture of the underlying mineral is visible through the non-opaque mineral in the image. This apparent texture is likely to be reported as extra borders, thus breaking the non-opaque mineral grain into smaller areas that are later discarded by the discrimination algorithm. It is therefore important to be able to counteract this effect and preserve closed areas that become segmented as a result of border improvement. An example of such a preservation outcome will be given later when discussing the algorithm in more details. A somewhat similar problem may occur if a non-opaque particle contains large internal cracks or if some portion of a particle is missing as a result of polishing ‘rip outs’. If an algorithm treats a portion of a particle that is mostly enclosed by other non-epoxy objects as epoxy, some non-opaque parts of the particle are going to be lost. All issues described in this section, as well as some of the more obvious issues such as dealing with “noise” in images, have been taken into account when developing a comprehensive set of algorithms with a number of user-adjustable parameters that are described in the next section. This section describes the steps being performed by the border-based non-opaque mineral discrimination routine that is now part of CSIRO Mineral4/Recognition4 software package for the characterisation of ores, sinter, coal and coke ( A brief description of the algorithm will be provided first, followed by a more detailed description of each step. In the discussion below, a map means a binary (black-and-white) image that is a result of the segmentation of a certain class of objects from the rest of the original photomicrograph; the objects of interest are usually represented as white. The algorithm consists of the following steps: Identification of opaque particles is performed based on their reflectivity (outside of the non-opaque module). A rough identification of non-opaque mineral borders is performed using dynamic thresholding. Based on the maps obtained in the first two steps, a rough identification of the larger epoxy areas is performed and the average RGB reflectivity of epoxy is measured. Opaque minerals in the original photomicrograph are then replaced with epoxy colour to minimise their effect on non-opaque discrimination. A second identification of non-opaque borders is performed, followed by border thinning and improvement to close possible gaps. The identified borders now separate the “epoxy-like” part of the original image into multiple areas. A number of tests are then applied to those areas in several passes, attributing them to either epoxy or to a non-opaque mineral, namely by: Size tests determining large epoxy areas and small noise objects to be treated as epoxy too. Shape tests assigning areas of complex shape to epoxy. Neighbour tests assigning areas to either non-opaque mineral or epoxy based on their already determined neighbours. Surround tests identifying certain areas within ambiguous border patterns as non-opaque mineral areas. Optional final operations are performed to avoid some misidentifications, such as restoration of broken particles. Following is a more detailed description of the non-opaque identification algorithm. First of all, primary border identification is being performed by the software using the Dynamic Thresholding function of the AxioVision software ( The two parameters used by dynamic thresholding are Size (the matrix size of the low pass filter in the  It is important to mention that by the time the execution of the software reaches its non-opaque mineral discrimination routine, particle identification (excluding non-opaque minerals) should already be accomplished. The result of particle identification is available to the rest of the program, including the non-opaque identification module, as a binary particle map. Although the technique, or rather combination of techniques, used by Mineral4 to obtain and clean up the map of particles, is beyond the scope of this article, it should be emphasised that correct particle identification plays the key role in subsequent non-opaque identification, as opaque mineral areas not recognised as parts of particles are then likely to be reported as non-opaque which will affect the quality of non-opaque border determination. The “first pass” of border identification, performed at this stage, is aimed at reliably determining at least some of the epoxy areas in the image in order to measure the average RGB reflectivity of the epoxy. At this stage two maps, the one representing known opaque particles and the map of identified non-opaque borders are combined together. Their combination represents all objects that are definitely known not to belong to epoxy or non-opaque mineral areas at this stage; non-opaque mineral borders, that have reflectivity significantly different from non-opaque mineral or epoxy body, are for that reason not considered “non-opaque” here. The map is then significantly dilated to close any gaps in the borders and also to cover areas adjacent to identified particles and non-opaque mineral borders that are likely to be somewhat different in colour from the epoxy. It should be emphasised that the dilation process is a very rough and non-selective mechanism, but is very simple from a computational point of view. It cannot be used for the precise identification of borders, but it is perfectly suitable for the purpose of a general closing of the borders and for excluding the areas adjacent to opaque and non-opaque particles from consideration. For example, The purpose of measuring epoxy reflectivity is to enable the next step in image preparation when, according to the existing particle map, the known opaque minerals are replaced on the image with areas of epoxy colour. It is performed in order to avoid situations where, after thresholding, connections are established between genuine non-opaque mineral borders and existing particles, therefore creating extra isolated areas not corresponding to any real objects. This removal of opaque minerals has to be performed on the actual image. Earlier versions of the program attempted to remove particles from the thresholded binary map instead, but a dilemma was encountered. Dynamic thresholding with settings used for border identification also tends to report structures in the near vicinity of particles, roughly corresponding to reflectivity gradients caused by particle surfaces imaged from just underneath the epoxy surface. Therefore a scenario where just the particle map was removed resulted in a situation of a “halo” still being present and causing possible false connections with non-opaque mineral borders. The halo issue can be resolved by using dilated particle maps so that the areas around particles are removed as well but this approach results in the loss of parts of non-opaque mineral borders where the non-opaque mineral is connected to another mineral or is touching another particle. When performing particle removal on binary maps there is no reasonable way to resolve the dilemma; however, for the original image where individual pixel values belong to a wide reflectivity range, it is possible not to simply superimpose the epoxy-coloured particle map on the image but to actually blend it into the image, using gradient transition around the particle borders. This way, the halo effect is mostly negated while the non-opaque mineral borders, more prominent than the irregularities around particle borders, can still be recognised during dynamic thresholding. This dilation/blending of the particle map is called “particle improvement” and is typically done to the level of 1 to 4–5 pixels depending on operator’s choice according to image peculiarities. One more operation performed with the particle map at the preparation stage is the optional identification of areas where known particles are close to each other. A map of separation lines is generated where such areas are present. These separation lines can later be used to break false connections reported where particles are close to each other, as these areas are often characterised with extra noise and more irregularly shaped and textured areas of epoxy. The separation technique used here is similar to one of the techniques developed for the main particle separation module of Mineral4/Recognition4; the difference is that it does not require the particle map to be eroded first because the purpose is not to disconnect already touching particles but rather to keep them disconnected after border improvement. After second dynamic thresholding step, performed over the image with any identified opaque material replaced by epoxy, the resulting map is cleaned up by scrapping to fully get rid of any noise, as shown in Thinning provides a good representation of the borders of larger non-opaque particles, however there are two side effects to be taken into consideration. First, thicker border areas are likely to generate “lines with spikes” due to the more prominent irregularities. Second, the textured inclusions of non-opaque minerals that produce irregular patterns instead of clear borders are likely to “collapse” and lose their shapes. To counteract this last phenomenon, there is an optional mechanism in the software package allowing identification of such inclusions before thinning and restoration of them after border improvement. Border improvement, performed at this stage, is a combination of binary dilation and thinning operations, each of which “grows” the existing thin lines with one pixel at each end. The number of such operations, or a “border improvement” parameter that will also be discussed later in the article, is adjustable and, depending on the sample, may be from 1 to 4–5. Extra growth operations, while they ensure larger gaps get closed, have no adverse effect on the closure of smaller gaps – once the gap is closed there are no further changes. There is though another possible negative effect – the spikes, generated by border thinning in the locations where borders were thick or non-uniform, will continue growing and can potentially connect to each other or to neighbouring objects. The growth of spikes is a serious obstacle to border improvement that has to be dealt with as it may result in the establishment of invalid connections between the borders of different particles. The next step in the algorithm is therefore to identify the nodes where spikes are connected to long particle borders. By breaking the nodes it is possible to distinguish between longer actual borders and much shorter spikes so most of the spikes can be cleaned up prior to final border improvement. Unfortunately it is impossible to fully eliminate the effect of spikes because the nodes themselves must have non-zero size, so some of the irregularity is still preserved. After all borders have been established, the map of particles is added to the map of borders once again, similar to what was done during initial epoxy identification. This combined map now represents all image areas known not to be epoxy or non-opaque. The map is then inverted so it represents a set of unidentified areas, some belonging to epoxy and other – to non-opaque minerals, separated by borders. Optionally the separation lines recorded earlier for nearly touching particles are applied here to break possible false borders. At this step it is time to determine which of the unidentified objects should be identified as epoxy, and which – as non-opaque minerals. A comprehensive set of criteria is used for identification and it is performed in several passes. The operator has access to a colour-coded map of all areas that shows why a particular area has been attributed to either a non-opaque mineral or epoxy category so that adjustments can be made to analysis parameters if necessary. To illustrate the process a bigger cut from the image used for algorithm adjustment is shown in The criteria used to allocate a particular object to epoxy or to a non-opaque mineral can be roughly divided into two categories: the independent criteria allowing classification of an object according to its own characteristics, such as area and shape, and the dependent criteria which rely on existing knowledge about the object’s neighbours, as will be explained further in more details. The allocation is done in several stages, or passes. Independent criteria are applied during the first two passes and allow identification of some objects. Based on that identification, dependent criteria are applied in second and subsequent passes. The independent criteria applied during the first pass take into account area size only, which can be measured very quickly. First of all, objects larger than triple the expected maximum particle size of the given fraction are declared epoxy, e.g. the “Large Epoxy” object coloured blue in the example in To complete the description of independent criteria, objects of complex “Swiss cheese-like” shapes are declared epoxy during the second pass as it is assumed that any non-opaque particles present will not have such textures (e.g. “Epoxy by Shape”, the magenta coloured object in The second category of dependent criteria allows an object to be assigned to a non-opaque mineral or epoxy category based on the existing knowledge of its neighbours. A neighbour in this context means “an adjacent object on the outer side of this object’s border”. The parameters in this group of criteria are represented by the percentage of an object’s perimeter that corresponds to a border with certain type of neighbours. It is important to mention that for these perimeter-based parameters there is a certain limit of precision with which the “neighbouring perimeter” can be measured. The imprecision can be caused by non-zero thickness of boundaries (especially when the neighbour is an opaque particle and so the border has not been thinned) as well as the presence of spikes and noise objects. When choosing the parameter values some allowance has to be made for this imprecision. Also, for an object intersecting an image frame only the portion of its perimeter not in contact with the image frame is considered. Two of the dependency tests are performed during the second pass of the image. In particular, if an object has more than a defined percentage of its border in contact with epoxy it is declared a non-opaque mineral ( During the third pass the remaining objects are tested again against the newly identified epoxy objects; this pass only allows identification of more non-opaque mineral objects (“Smaller N.-O.”, coloured dark green in The last dependency check that is employed during the fourth pass for the objects in the “probably epoxy” category is a “surround check”. This check can recognise certain objects within the “other epoxy” objects as non-opaque particles based on the number of their neighbours. It is assumed that any as yet unidentified “locked epoxy” object, that is, an area of epoxy not connected to the main body of epoxy (such as area A in After the “surrounded” non-opaque mineral is restored, the discrimination is complete and can be observed by the operator as a coloured map of identified objects, see This description of our non-opaque mineral discrimination algorithm has mentioned a number of operator-adjustable parameters and options that can be used to improve non-opaque mineral discrimination depending on the properties of a particular sample and the imaging settings. Importantly, even if these adjustments are required, typically they need to be performed over only one, or several, representative images in a set that can consist of multiple (possibly hundreds) of images, with the rest of the images then being processed in fully automated mode using these adjusted settings. Moreover, Mineral4 allows the operator to record those settings as an analysis profile that later can be applied to similar samples. Mineral4 also records the profiles and mineral maps automatically so, if necessary, image analysis of any set of images can be verified or repeated with adjusted parameters. The “border improvement” is one of the most important parameters, and probably the single most important. There are two issues to be taken into consideration when choosing the border improvement value. On one hand, because of the neighbour-based discrimination technique it is very important to have all the large non-opaque mineral particle borders closed. Having a break in a border will not only result in the non-identification of a particle, but, where multiple touching objects are present, also in possible false identification of some of the adjacent epoxy objects. On the other hand, a high border improvement value can result in the production of multiple false borders. The algorithm discards smaller objects and treats all as yet unidentified objects in clusters as epoxy, so false identifications here are unlikely but still possible; more importantly, the chances of non-opaque mineral non-identification because of clustering will increase. Even more importantly, object-by-object operations, especially when measuring touching and surrounded perimeters, consume a significant amount of computing power with approximately quadratic dependency on the number of objects (as opposed to the whole image transformations of earlier stages) and may dramatically increase the processing time, even though the algorithm has been specifically optimised for such measurements. However, with a reasonable choice of parameters, the adjustments made by the operator of the software were found not to significantly affect the software’s performance. This article describes a method which contradicts the established view that optical image analysis cannot reliably discriminate some non-opaque minerals with reflectivities close to that of epoxy, such as quartz during automated processing. The comprehensive methodology described in the article allows reliable discrimination of non-opaque minerals based on their optical relief making CSIRO’s Mineral4/Recognition4 software suite, which incorporates the methodology, a valuable tool for the characterisation of ores with a significant content of non-opaque minerals such as quartz. Optical relief depends on the difference in refractive index between the mineral and mounting medium, therefore it can be controlled during sample preparation by choosing an epoxy with a refractive index distinct from that of the expected non-opaque mineral. The first version of the software algorithm we developed for border-based discrimination of non-opaque minerals showed very promising results during the analysis of manganese ores containing well-liberated quartz. As the algorithm was applied to a greater variety of samples a number of issues that can potentially reduce the quality of non-opaque minerals discrimination were encountered. The algorithm has since been refined in order to overcome those issues, which include: ambiguous mineral-epoxy patterns in the presence of multiple touching particles; poor border recognition; cracked or non-uniform particles; and the presence of noise. The resulting algorithm is a multi-stage process that includes: border identification based on dynamic thresholding; identification of the major areas of epoxy and their reflectivity; “particle improvement” with gradient blending of known opaque particles into the epoxy so that only non-opaque borders are left; optional recording of separation lines between known particles; optional preservation of non-uniform non-opaque objects; and noise removal. “Border improvement”, the most important step of the algorithm, is used to close any gaps in the non-opaque mineral border caused by image irregularities, whereas “spikes removal” is also used at this stage to avoid the creation of false borders. The resulting set of epoxy-like objects separated by borders is put through a series of tests to distinguish between actual epoxy and non-opaque mineral areas. The improvement of the non-opaque mineral map, including the optional restoration of broken particles, results in the creation of the final mineral map available to the rest of the software. The described non-opaque mineral discrimination routine is highly adjustable with a set of user-defined parameters, however for a number of parameters the default values tested on a number of samples are believed to be suitable in most cases. It is important to keep the border improvement parameter value reasonably low as an unnecessarily high value may significantly increase the processing time. The authors would like to acknowledge CSIRO Process Science and Engineering for funding this work and wish to thank James Manuel, Sarath Hapugoda and Michael Peterson for samples provided during the research, and also Abebe Haileslassie for sample preparation.