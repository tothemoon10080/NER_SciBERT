Mathematical models describing precipitation processes in one step need to be upgraded. Particle size distribution is a crucial variable and its inclusion in the modelling libraries is necessary if the technology wants to be optimized through simulation. With this objective, a mass based population balance model is presented in this contribution. The model has been constructed using a stoichiometric matrix and a kinetic vector and using mass as the internal coordinate, as it is usually done in wastewater treatment modelling. Identifiability of the parameters of the model was evaluated using a sensitivity and a collinearity analysis for six simulation case studies of struvite precipitation. In addition, parameters in the model were calibrated to represent data from two batch tests in the laboratory. The results of the analysis showed that the identifiability of the parameters depends on the available experimental data and explored scenarios. Identifiability of the parameters could be the reason behind the shifting parameter values describing mechanisms of precipitation in the literature. This contribution helps to understand the possibilities and limitations that the population balance model approach offer.Struvite (MgNH Mathematical modelling and simulation have been proved as useful tools for the design and optimization of new and existing WWTPs and their unit processes. The precipitation process of struvite and other interesting materials have already been included in mathematical modelling and simulation libraries for WWTPs ( It is known that struvite performance as a fertilizer depends on the obtained particle size distribution (PSD) ( The PBM can successfully describe the evolution in time and space of the distribution of properties of a group of discrete entities (particles, bubbles, cells, etc.) dispersed in a continuous phase. It typically considers an additional internal coordinate, which is some measure of the particles’ size. It includes explicitly inner mechanisms of the precipitation process and is able to predict the evolution of a PSD in a reactor. The main equation of the PBM for a batch experiment can be expressed as ( These equations are used to define a general case of the PBM when it is based on particle number. The analytical resolution for the PBM is only possible for the simplest cases, consequently, numerical methods, often involving some kind of discretization or decomposition of the main equation, are used for its resolution ( PBM has been proved to be successful to track changes in the PSD in the struvite precipitation already ( Firstly, PBM models have generally been defined using number of particles as the dependent variable of the process, which is coherent with the model purposes, but, can lead to mass discontinuities ( The second aspect is that obtained parameter values for the parameters defining inner mechanisms of the precipitation of struvite are very variable in the literature ( The first objective of this contribution is to present a PBM scheme based on a mass balance approach where the mass is conserved and it is compatible with wastewater treatment models conventionally used. For this issue, the PBM was adapted to a conventional model structure in wastewater treatment modelling, where mass of the crystal entities is used as the internal variable, instead of particle number. The second objective is to evaluate the theoretical parameter identifiability of the constructed model using model analysis tools as sensitivity analysis and a collinearity analysis. This evaluation is helpful to understand the goodness of the modelling framework before any calibration procedure is followed. To conclude the paper, model parameters were adjusted heuristically to reproduce experimental data obtained in two laboratory tests, as a preliminary illustration of the predictive capacity of the model. In this section, the information is divided in three subsections. In The model presented in this contribution describes the precipitation process of struvite. The main reaction for this process is: The mathematical model presented here is a Discretized Population Balance Model (DPBM), where particle sizes are defined after partitioning the crystal size range in 30 bins. Each of the bins corresponds to spherical particles sized between 0.001 and 0.812 mm of radius. The volume size defined for each bin is twice the previous one, following a geometric partition of the size domain. As a consequence, PSD in the model is a truly discrete discretization where only particles of size v, 2v, 4v, etc. exist, being v the volume of the smallest spherical particle size considered. The difference between the DPBM presented in this contribution and most of the PBMs available in literature is the way in which particle-particle and particle-liquid interactions are defined. In this study mass is used as the internal coordinate, instead of using particle number. Each particle size bin is considered as a component in the model and its interaction with other components (ions in the liquid and/or other solid bins) is described by the precipitation mechanisms and is based on the mass continuity of the components. The ions considered are those employed in urban wastewater treatment models. They have been defined using common wastewater equilibrium reactions, as ion pairing and acid-base reactions, following guidelines and equations proposed in The mechanisms of precipitation in this contribution (homogeneous nucleation, particle growth and aggregation of particles) are defined using a Petersen matrix for the stoichiometry and a vector of kinetics. The kinetics of mechanisms are defined in a general way as power-law functions dependent on supersaturation index (SI) and kinetic rates and exponents. The SI is calculated using the ion activity product (IAP) of the species conforming the struvite and the solubility product of the salt. As the PBM is mass based, the model could be further extended with other reactions as: liquid-gas transfer, other salts precipitation or other chemical reactions in a systematic and simple way in order to simulate struvite or other salt precipitation process in a reactor operated with real wastewater. Mechanisms not considered in this article, such as breakage or secondary nucleation, could be added too. However, this model accounts for the most important mechanisms, maintaining a good compromise between relatively simple implementation and realistic results. In the next subsections each mechanism is described in detail. Homogeneous nucleation is the spontaneous creation of small entities from the liquid phase in the absence of other solid bodies. These entities are in the edge of liquid and solid phase, some of them re-dissolve into liquid and others become the starting point of the precipitation. It is uncertain how homogeneous nucleation happens, however, it is usually accepted that a sequence of bimolecular additions is the cause ( The created crystal mass of size r = 0.001 mm is proportional to the reactants consumption as defined in the stoichiometry. This appearance rate is defined as: Mass change in the smallest sized bin due to nucleation is: Once the nuclei stabilize, precipitation occurs through particle enlargement processes: particle growth and aggregation. Particle growth is the particle enlargement process where particles increase their size by consuming reactants. The rate of change in the size of particles is defined as: In addition to the SI, the mass of a bin As the area is not a variable included in the model, it has to be converted to a term depending on mass: Substituting The definition of these steps and the interaction with the ions in the reaction is defined in Aggregation is the particle enlargement process where the effective impact of two small crystals form a bigger one. It is thought that some consumption of the dissolved ions is needed to create the bond between two colliding crystals ( When considering a geometrically partitioned size spectrum, a problem arises when modelling the collision of two spheres. If the colliding particles have different volumes (as an example, v and 2v) the model cannot represent the birth of the 3v sized sphere, as this size is not defined. To overcome this problem, in this contribution, the approach of Hounslow for the discretization of the aggregation process ( The development of the aggregation mechanism starts defining that the effective collision of particles of two different sizes (i and j, being j ≤ i) is proportional to the number of entities present in the model: For the Death Term, the mass of j size leaving the j-th bin due to collisions with class i will be the number of this effective collisions multiplied by the mass in each j sphere: With this assumption, and considering that for the Birth Term, the mass of i+1 size formed due to collisions between particles in i-th and j-th class, will be the sum of the mass leaving i and j classes due to collisions, mass of the solids is automatically conserved during aggregation: Combining equations: Thus, considering all the mechanisms involved, the observed conversion rates for each bin is: The use of mass as internal coordinate in PBMs is uncommon and, to the author's knowledge, it has not been used to simulate struvite precipitation until now. An identifiability analysis of the kinetic rates and exponents defining the mechanisms described in For the simulations performed in this contribution, six different simulation case studies were defined in WEST-DHI. Case studies A, B and C were operated in batch mode, with very high SI and no seed material. In contrast, case studies D, E and F corresponded to a continuous operation of a precipitation reactor with an initial seed loading. All the simulations considered the reactors as Completely Stirred Tank Reactor (CSTR). All the SI provided correspond to the equilibrium value of the SI that would be obtained if no reaction occurred in the reactors. Each of case studies A, B and C was a CSTR of 1 l capacity with an initial volume of 500 ml of a solution containing KH For case studies D, E and F a reactor of 11.4 l of capacity was used. Temperature was 21 °C. Precipitation process started with the reactor full of a solution containing 0.228 mol/l NH The objective of running a sensitivity analysis is to verify how important each parameter is for the performance of the model. Usually, it is employed to simplify overparameterized models. In this contribution it is used to verify that in the parameter range chosen, all the parameters and, consequently, the mechanisms, play a role in the outputs, as a previous step to the model calibration. Evaluated parameters and their ranges are included in The sensitivity analysis can be done following a global sampling technique or a local analysis technique. Global sampling methods pick parameter sets in the previously defined hyperspace in order to run the simulation with them. When enough simulations are done, an idea of how the results of the simulation change depending on the values of the parameters can be obtained ( Considering the big uncertainty in the values of the kinetic parameters, and in order to explore a large zone in the parameter hyperspace, the sensitivity analysis was performed integrating a local analysis technique into a global sampling method. This integration consists on repeating the local analysis in many randomly or systematically sampled points. In this contribution, the Latin Hypercube-One factor At a Time (LH-OAT) method proposed by For the quantification of the effect of each parameter, a little variation was introduced in the parameter of interest while the rest were maintained constant. The difference on the outputs for the simulations with and without this variation were computed. The result was the univocal variation on the model's outputs for the change in each parameter: The operation was repeated for all the parameters being analyzed in each sampled point for the six different case studies: p*(n+1) simulations of each case study were performed, where p = 300 was the total number of points of the hyperspace selected by the LH and n = 6, the number of parameters. Therefore, the influence of the six kinetic parameters used in the model was quantified using a total of 2100 runs for each of the six simulation case studies. The result of this iterative operation is a tridimensional matrix: a bidimensional matrix for each p sampled point with m (number of outputs) rows and n (number of parameters) columns. The elements in these bidimensional matrixes are the partial effect of each parameter on each output, Total influence of the parameter in each point ( The averaged results formed a bidimensional matrix A set of parameters in a model is identifiable if it fulfils two conditions: First, the individual change in the parameters has to affect the model outputs. Second, the change in one of the parameters cannot be compensated with an adequate change in another parameter ( In the collinearity analysis, parameters are usually organized in subsets. These subsets have k parameters, being k ≤ n, the total number of parameters in the model. The Collinearity Index of the parameters under study ( Being As the identifiability of a parameter set depends on both the impact on the output of the change in the parameters and the linear independency of the subset, an additional index was calculated. The Importance Index A high sensitivity and a low collinearity will result in a high The collinearity analysis was performed for all the points sampled with the LH for two types of parameter sets. First, all the parameters were analyzed in pairs to see if there were direct compensation effects between parameters in certain zones of the chosen range. Second, the Collinearity Index and the Importance Index was calculated for the six parameters, to find zones of the parameter range where all the parameters in the model are identifiable for the case studies used. The parameter identifiability study was done combining Matlab and WEST-DHI. The LH scheme was implemented in Matlab and the values of the parameters picked for each run. Once these values were chosen, the information was sent to the WEST simulation platform and the six case studies were reproduced. The information about the outputs of the model was recorded from the WEST simulation and translated to Matlab. Afterwards a perturbation of 1% was introduced in the first parameter and the simulations in WEST were repeated with the perturbed parameter set. This operation was repeated for all the parameters under study. The information of the outputs was used to calculate the sensitivities, the Collinearity Index and the Importance Index. Experimental data for the determination of the parameter values was obtained from precipitation batch tests run in the laboratory. The batch test were performed in a magnetically stirred cylindrical vessel. The magnetic stirrer rotated at 300 rpm in all cases, to ensure similar hydrodynamics in all runs. 2 experimental conditions (corresponding to simulation case studies A and B) were used. Each of the conditions was run twice. The objective was to analyze the effect of different initial SI on the pH evolution and on the final PSD. In all the cases, 500 ml of a dissolution prepared with a determined quantity of KH Each of the precipitation process was run for 20 min. The information used for the determination of the kinetic rates and exponents, was the evolution of pH and the final PSD. pH was measured every half second for the 20 min that the experiment lasted. After the 20 min, the experiment was stopped. The precipitated solid was filtered and dried at 40 °C for 96 h. Total mass of obtained solid was weighted and after that final PSD was obtained measuring the dried solid in air suspension by laser diffraction using a SYMPATEC H820. The model presented in section Results from the sensitivity analysis showed that all the parameters had some effect on the outputs. The limit for considering a parameter non identifiable due to its low effect on the outputs is 1/1000 compared with the parameter with the biggest effect ( As observed in Attending the nucleation rate and exponent, Kr Nucleation had a constant and relatively low effect on the outputs for all the range. This result agreed with other studies, where even for larger ranges of the parameter value the change in the nucleation constant had a little total effect ( Kr Growth and Growth Exponent showed different tendencies. The sensitivity of the Kr Growth is relatively constant for the whole range. Its value is nearly twice the value of the Kr Nucleation, but it is significantly smaller than the sensitivities of the three exponents. Sensitivity of the Growth Exponent reached the highest sensitivity of the six parameters for its lowest values. This highlighted the relevance of the process: Growth process is an important mechanism for different experimental conditions as it has a big effect on reactants consumption and, consequently, in the PSD. Sensitivity of the Growth Exponent decreased when its value increased, but it maintained a high sensitivity for the whole range. Considering the terms that define aggregation, Kr Aggregation had a low and constant effect for all the parameter range. On the other hand, Aggregation Exponent presented higher average sensitivities as it increased. However, the dispersion of the values of the sensitivity was bigger than it was for other parameters, having some of the high values of the Aggregation Exponent a big effect on the outputs and others a very small one. This phenomenon needed further study and for that issue the effect of the Aggregation Exponent was analyzed for each case study individually and the results recorded in From this analysis some ideas were obtained. Firstly, there was a clear increase of the effect of the Aggregation Exponent as its value increased for the case studies A and B. This effect could be explained in the model because a higher value of the Aggregation Exponent would mean a higher speed of aggregation for high SI for the same concentration of particles. Therefore, particles would get bigger faster at the initial steps of the precipitation (without reactants consumption), reducing the available surface area. Less surface area would mean less possibility to grow, which would mean a slower precipitation. A slower precipitation would maintain the SI high for more time, making the aggregation process important for a longer period of time. However, experimental evidence from the literature show that when reactors are operated unseeded and high SI, formation of fines governs the precipitation process rather than aggregation ( From the analysis of the parameters of the aggregation, two conclusions could be obtained: the first one was that the effect of the Aggregation Exponent for the highest values seemed not to be able to represent correctly the mechanism, as it gained relevance in case studies where it should not be important. The second one was that for certain experimental conditions (case studies D, E and F), the effect of the Aggregation Exponent can be important, and therefore, aggregation should always be considered when modelling crystallization processes. The identifiability analysis finds possible correlations amongst the parameters under study. As the objective of this analysis was to evaluate the possible interactions in the model, all the parameters were considered. However, when the number of parameters increases it is difficult to see their real effect on the Collinearity Index. Therefore, looking for direct compensation effects, the Collinearity Index and the Importance Index was calculated first for each point sampled with the LH for every pair of the parameters. Afterwards, the operation was repeated for the whole set of six parameters that describe the model. Results of the maximum value of the Collinearity Index, the maximum Importance Index and the minimum Importance Index for the analysis for parameter pairs were included in Collinearity Index values between 15 and 20 have been given as critical for parameter identifiability in the literature ( Kr Aggregation and Aggregation Exponent had collinearity problems for big values of the exponent for any value of the Kr Aggregation. This agreed well with the sensitivity of Kr Aggregation, which was low and constant for the whole range (see More generally, pair of parameters sharing mechanism (pairs 1 and 10) or pair of parameters with the same relationship with SI (pairs 2 and 7) could have direct compensation problems if less simulation scenarios or data was used for the identifiability analysis. For instance, if only the information of the case studies A, B and C was used, the effect on the outputs could be compensated (being the Collinearity Index up to 31) for Growth Exponent and Nucleation Exponent when both had big values, especially Growth Exponent. These two parameters determine the relationship of nucleation and growth with the SI within the crystallization. High values of Nucleation Exponent would lead to high values of concentration of the first bin very fast, which would at the same time accelerate the growth from the first bin to the second, the second to the third and so on. High values of Growth Exponent would accelerate growth at high SI, too. Therefore, for certain experimental conditions (in this case, case studies A, B and C) these parameters could be correlated, even for a big amount of considered data. As in the analysis a total of six case studies were considered, this correlation was not a problem, as the case studies represented experimental conditions where their effects could be distinguished. Results from the Importance Index for the parameter pairs (see Results of the collinearity analysis of the whole parameter set, stated that from the 300 sampled parameter combinations, 251 had a Collinearity Index below the threshold of 15. As the six parameters can be involved in combinations with high Collinearity Index (almost 15 or more), finding a zone graphically with no collinearity issues that include the effect of all the parameters is not straightforward. Therefore, the effect of the collinearity is included in the representation of the Importance Index. The Importance Index combines information from the sensitivity and collinearity of the parameters. From the obtained results it could be concluded that there were zones of parameter values with theoretical identifiability problems. This could be even more problematic if less data or experimental scenarios were used, as it is the usual case for PBM calibration. The identifiability problem could explain the differences in the values of the parameters found in literature for calibrated PBMs, more than small changes in the structures of the PBM or the used solving method. Considering this, a calibrated PBM should clearly indicate the limits of its application, as it is possible that the parameters chosen are not general values, but compensated among them for the case studies and/or parameter values chosen. In addition, when using the models, it should be considered that the parameter values can be good enough to represent a certain amount of data, but it is not correct to consider the processes or parameters individually, as they might be biased by the value of the rest of the parameters of the model. On the other hand, there were zones where the identifiability was possible for the data and case studies used. Some of the zones of the parameters with high identifiability (mainly for the exponents) were reasonable values, according to classic precipitation theories. This is important, as enforces the idea that the PBM can explain the precipitation in a realistic way, by including the main mechanisms in an explicit way. Based on the information obtained in the mathematical analysis conducted previously, the parameters under study were adjusted to reproduce the data obtained from the experiments undertaken in the laboratory and explained in For the adjustment, values were chosen from the zone of the highest identifiability for those parameters that obtained a high value of the Importance Index in the previously conducted analysis (exponents and Kr Growth). Kr Nucleation and Kr Aggregation were parameters with lower identifiability and their effect is not as important on the outputs as that of the rest of the parameters. Once the most important parameters were fixed, they were manipulated within the analyzed range in order to obtain a value that led to a reasonable similarity between the experimental data and the results from the simulations. The Nucleation Exponent was fixed at 5. This value agrees with other contributions where it is stated that the exponent for secondary nucleation is often above 2 and the exponent for homogeneous nucleation is typically much higher ( Growth Exponent was fixed at 2. Growth Exponent presented a high identifiability for zones in which its value was low. In addition, classic growth theories state that the value of the Growth Exponent is usually between 1 and 2 ( Regarding Aggregation Exponent, as mentioned in Kr Growth was selected in this contribution at 12 mm/d, slightly lower than the value of 18 mm/d obtained in As explained above, the parameters with the lowest impact in the outputs were adjusted at the end: Kr Nucleation was fixed at 10 Values obtained for the parameters are recorded in  For the optimum design and operation of material recovery technologies based on precipitation, conventional models used in the wastewater framework should be updated, for example considering PSD and the effect of some operational variables. Developments done in the paper have been focused on two main aspects: A new mass based PBM has been developed coherent in its structure with conventional wastewater treatment models and compatible with them. The model has been described using the usual notation in wastewater treatment modelling (stoichiometric matrix and kinetic vector), state variables are mass of components instead of number of particles, which guarantees mass continuity. The model proposed in this study included main precipitation mechanisms and common wastewater equilibrium reactions, as ion pairing and acid-base reactions. Moreover, other reactions related to liquid-gas transfers, used in some precipitation technologies, or even biological reactions could be easily incorporated if required. The model constructed has been implemented successfully in WEST-DHI simulation platform. The results obtained from the sensitivity and collinearity analysis demonstrate that all the parameters have some weight in the outputs and that there are large zones of the parameter values where the identifiability is possible. Therefore, the structure of the model is considered valid. However, zones where correlation exists between the parameters were identified. Correlation effects could explain the variability in the parameter values found in the literature, where less data is available for calibration than the one generated synthetically. Correlation effects of the parameters should be considered before calibrating a PBM. Finally, the model has been experimentally verified and it demonstrated its capacity to reproduce some experiments performed in the laboratory with reasonable values of the parameters. Further research will include a more rigorous calibration using more experimental data. The authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper. The authors would like to thank the  Activity of ion i Total area of the crystals of size i Birth Function Nucleation Rate Completely Stirred Tank Reactor Concentration of i sized crystals Death Function Size Independent Linear Growth Rate Discretized Population Balance Model Variation in the parameter Ion Activity Product Kinetic Rate of Aggregation Nucleation Kinetic Rate Kinetic Rate of Growth Kinetic Rate Solubility Product Constant Crystal Length Latin Hypercube Latin Hypercube-One Factor at a Time Characteristic Length of i size Total number of variables Model Outputs Mass of a single sphere of size i Magnesium Molecular Weight of compound i Population Density Total number of parameters Nitrogen Number of Particles per volume unit Biggest Bin Kinetic Exponent of Aggregation Nucleation Kinetic Exponent Exponent of Growth Kinetic Exponent One Factor at a Time Phosphorus Number of sampled parameter set Population Balance Model Particle Size Distribution Plant Wide Model Radius Kinetic Rate Sensitivity Matrix Saturation Index Sensibility caused in i-th variable, by a change in j-th parameter in k-th point Normalized Sensitivity Matrix of k parameters Volume of the smallest sphere Reactor Volume Wastewater Treatment Plant Total mass of the i sized bin  Aggregation Rate Vector of coefficients Collinearity Index of the k parameter set Total influence of the parameter in each point i-th parameter Smallest Eigenvalue of the Matrix Density Importance Index