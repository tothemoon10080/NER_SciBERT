Geostatistical simulation is used in risk analysis studies to incorporate the spatial uncertainty of experimental variables that are significantly under-sampled. For example, the values of hydraulic conductivity or porosity are critical in petroleum reservoir production modelling and prediction, in assessing underground sites as waste repositories, and in modelling the transport of contaminants in aquifers. In all these examples connectivity of the permeable phase or permeable lithofacies is a critical issue. Given an indicator map on a regular two- or three-dimensional grid, which can be obtained from continuous-valued or from categorical variables, CONNEC3D performs a connectivity analysis of the phase of interest (coded 0 or 1 by an indicator function). 3D maps of multiple indicators, categories or continuous variables can also be analysed for connectivity by suitable coding of the input map.
                  Connectivity analysis involves the estimation of the connectivity function τ(h) for different spatial directions and a number of connectivity statistics. Included in the latter are the number of connected components (ncc), average size of a connected component (cc), mean length of a cc in the X, Y and Z directions, size of the largest cc, maximum length of a cc along X, Y and Z and the numbers of percolating components along X, Y and Z. In addition, the program provides as output a file in which each cc is identified by an integer number ranging from 1 to ncc.
                  The implementation of the program is demonstrated on a random set model generated by the sequential indicator algorithm. This provides a means of estimating the computational time required for different grid sizes and is also used to demonstrate computationally that when the semi-variogram of the indicator function is anisotropic the connectivity function is also anisotropic.
                  There are options within the program for 6-connectivity analysis, 18-connectivity analysis and 26-connectivity analysis. The software is provided in two formats, as a stand-alone program that can perform connectivity analysis of an indicator map and as a subroutine that can be repeatedly called in order to calculate averages of connectivity analyses of a large number of realizations of indicator maps, or to identify critical realizations generated by conditional simulations of continuous variables or categorical variables.In geostatistical simulation the uncertainty in the spatial variability of a regionalized variable is taken into account by generating a large number of realizations of a random function model, each of which has the same semi-variogram as the experimental data and honours the observations. In many practical studies, a critical issue is the connectivity of a given phase, or lithofacies, of interest. This phase and the remaining phases (i.e. complementary phase) can be represented by an indicator variable that takes values of 0 or 1. Such a dichotomous or binary dataset can be derived from a continuous variable (e.g. porosity) using one or more thresholds, or from a categorical variable (e.g. rock type) by classification into two groups. Connectivity analysis of these datasets is of interest in answering questions such as “what is the probability that two given locations are connected?” or “which is the most likely set of locations connected to a specified location?” or “what is the expected maximum size of a given connected component (i.e. connectivity path)?”. The nomenclature used in this paper is that defined by Given an indicator map, the connectivity function is not only a function of the proportion of phases and the indicator semi-variogram but also of the entire multivariate probability distribution. Thus, different stochastic simulation models, which can equally well reproduce the proportions and the indicator semi-variograms, may give different realizations in terms of the connectivity function. This was shown by  Given a parallelepipedic set For example, In practice, the members of Two points, The connectivity function is estimated by Each connected component of One or both blocks have an index 0. This couple does not contribute either to # Both indices differ from zero but do not have the same value. This couple increases # Both indices are equal and differ from zero. This increases the values of # A description of the program is given in the following section. The input data for CONNEC3D is a nine-line parameter file similar to the example shown in Note that the program is not confined to the analysis of a single phase and 3D maps with multiple indicators, multiple categories or continuous variables can also be analysed for connectivity. For multiple indicators or categories, the map must be pre-processed to generate an input map fro which the indicator(s) or categories of interest are assigned an index of 1 and all others an index of 0. For a continuous variable, the range or ranges of values of interest are defined by thresholds and the values between those thresholds are assigned an index of 1 with all other values assigned an index of 0. Thus the input indicator 0/1 map is a question of format and not a restriction on the type of data that can be analysed. An example of an output file of the connectivity statistics is given in Mean size of a connected component (cc) in pixels or points. Mean size of a cc in real units. Mean size of a cc relative to the size of the phase analysed. Mean length of a cc in the Mean length of a cc in the Mean length of a cc in the The maxima statistics are: Code number of the largest cc. Size of the largest cc in pixels. Size of the largest cc relative to the size of the analysed phase. Largest length of a cc in the Largest length of a cc in the Largest length of a cc in the The minima statistics are: Size in pixels of the smallest cc. Smallest length of a cc in the Smallest length of a cc in the Smallest length of a cc in the In the percolation group the following statistics are reported: Number of percolating cc in the Number of percolating cc in the Number of percolating cc in the Finally the connectivity function is given for the following directions:    Fist main 3D diagonal direction (1,1,1). Second main 3D diagonal direction (1,−1,1). Third main 3D diagonal direction (−1,−1,1). Fourth main 3D diagonal (−1,1,1). Average of Average along the four 3D diagonals. First diagonal of Second diagonal of First diagonal of Second diagonal of First diagonal of Second diagonal of Directions given in parentheses ( Each record of the connectivity function output file contains four values: the distance for each lag, the connectivity function, the number of couples of pixels that are connected for the given lag distance, the number of couples of pixels that, for the given lag distance, belong to the phase of interest. The output file containing the connected components is similar to the indicator map but a different set of codes replaces the indicator values (0 or 1). A value of 0 is assigned to the phase that has not been analysed. The analysed phase is classified in terms of its connected components, each of which is coded with a different integer value from 1 to ncc (number of connected components). There is no ranking attached to this code, it is simply the order in which the program identifies the different connected components. The code of the largest connected component is recorded in the statistics file. An example of this file is shown in Each record of the output file for the connectivity function file contains the four values described previously for the 13 directions together with the averages described previously and in the same order as they appear in the statistics output file. To facilitate the importing of these output values into a graphics program no headings are entered in this file. The performance of CONNEC3D is demonstrated on a random set model generated by the sequential indicator simulation algorithm. A description of the indicator simulation algorithm may be found, among others, in The experimental proportions of each category from the simulation were 0.4945, 0.301 and 0.2045, respectively. The statistics for category 1 are given in  The first category with proportion 0.5 has 858 different connected components while the third category with proportion 0.2 has 11980 connected components. The CFs for the third category are shown in In essence the CF depends on: the type of connectivity considered (6-connectivity, 18-connectivity or 26-connectivity). the proportion of the category of phase analysed. the covariance (semi-variogram) structure of the category analysed. the random set model used to generate the simulation of categories, i.e. the multivariate probability density function of the random function model. The third factor is included in the fourth but is taken itemized separately as second-order moments are popular tools in geostatistical practice. The value of the CF increases as the connectivity analysis increases from 6 to 18 and to 26 because the number of connected components decreases thus increasing the chances of two blocks belonging to the same category being connected. The CF also increases as the proportion of the phase increases because this increases the correlation length of the covariance structure; as the correlation length increases the relation between CF and random set model may be difficult to establish unless it is done empirically by Monte Carlo simulation. The computing time required for a connectivity analysis of an indicator map obviously depends on the size of the grid analysed and the processor unit of the computer used. It is also a function of the number of connected components, which means that performing a 6-connectivity analysis will take longer than performing a 26-connectivity analysis of the same category. For a 1 In many studies connectivity is a critical factor when conditional simulations are used to assess the effects of the spatial uncertainty of a variable (e.g., porosity, permeability, transmissivity) Connectivity may be assessed by the connectivity function calculated from indicator maps of the regionalized variable. These indicator maps can be derived by applying different thresholds to a continuous variable or by a binary classification of the values of a categorical variable. The connectivity function must be calculated for different directions as it may be anisotropic. For any distance, the connectivity function gives the probability that any two blocks separated by that distance, and belonging to the phase of interest, are connected. This provides a means of constructing maps of the probability of connectivity to a given location (to a well for example) or connectivity between two locations (two wells for example). It may also be of interest to estimate the connectivity function for a given experimental data set using different random set models. CONNEC3D can perform connectivity analysis of an indicator map, or of a large number of indicator maps in order to identify critical realizations (for example percolating realizations). This work has been supported by UK Engineering and Physical Sciences Research Council (EPSRC) grant reference GR/M72944. We would like to thank the reviewers for providing constructive criticism, which has improved the content of the paper.