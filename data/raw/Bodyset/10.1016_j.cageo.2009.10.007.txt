In geostatistical applications, automated or semi-automated procedures are often used for modeling the spatial correlation structure (simple and cross variograms) of multivariate data. This paper deals with the well-known linear model of coregionalization and presents three iterative algorithms to find out coregionalization matrices that minimize a weighted sum of the squared deviations between sample and modeled variograms. The first one is a variation of Goulard and Voltz’s proposal for variogram fitting with no constraint other than mathematical consistency. The second one uses simulated annealing for fitting subject to constraints on the simple variogram sills. The third one is a nonlinear least squares algorithm for fitting a plurigaussian model. In all three algorithms, the sample variogram matrices need not be entirely known for every lag vector, a situation of interest with heterotopic samplings. To demonstrate the capabilities of the proposed algorithms, a set of computer programs is provided and applied to case studies in mineral resources evaluation.The prediction or simulation of a set of co-regionalized variables (coregionalization) arises in many disciplines of the earth sciences, including mineral resources evaluation ( Several models have been proposed for representing the spatial correlation structure of a coregionalization. Because of its relative simplicity and versatility, the   { { The model is mathematically consistent provided that all the coregionalization matrices are positive semidefinite, i.e., their eigenvalues are nonnegative ( In this section, our objective is to fit a linear coregionalization model under the restrictions of positive semidefiniteness of the coregionalization matrices and knowledge of the basic variogram models. To this end, a least squares algorithm will be proposed. Although least squares variogram fitting techniques have been extensively used in the past decades, e.g., ordinary least squares ( Let us denote by Typically,   Compute For Calculate Perform the spectral decomposition of  Set to zero any negative entry of Update Compute The convergence of the algorithm has been observed empirically by many practitioners and demonstrated by The case of partially unknown sample variogram matrices arises when some variables of the coregionalization are undersampled in comparison to others (heterotopic sampling). To solve this problem, Let us modify the weighted sum of squares as follows: The GV algorithm is modified as follows:   Compute For Assume that all the coregionalization matrices are known, except  For (  Define Perform the spectral decomposition of  Set to zero any negative entry of Update Compute Following the work of when when the diagonal matrices In the case of second-order stationary random fields, the algorithm can be modified to fit the simple and cross covariances { The algorithm can also be adapted to the fitting of non-centered covariances. In this case, one has to consider an additional structure The proposed algorithm has been implemented in a Matlab routine called VARGFIT, which is provided together with this article. The inputs of VARGFIT are the parameters for sample variogram calculations in To avoid a variable from having an excessive influence on the fitting, the weight The outputs of VARGFIT are the matrices of coregionalization, weighted sum of squares ( The potentiality of program VARGFIT is now illustrated on two examples. We consider a data set from a deposit located in northern Chile that has been recognized by a diamond drill hole exploration campaign. Three grade variables have been measured, namely the copper (main product), silver (by-product) and arsenic (impurity) grades. All the variables are cross-correlated ( The simple and cross variograms of the three grade variables have been calculated along the horizontal and vertical directions (with an azimuth tolerance of 90° and a dip tolerance of 20°), for lags multiple of 10 a nugget effect an exponential variogram with ranges 10 an exponential variogram with ranges 10 a spherical variogram with ranges 20 The weights are chosen proportional to the numbers of data pairs used in the calculation of sample variograms, and inversely proportional to the prior variances of the variables (Eq. Slightly different fittings can be obtained by modifying the weighting option, e.g., weights proportional to the number of data pairs and inversely proportional to the lag distances. The second example is related to grade prediction for short-term planning. One avails two sets of data, one from exploration drill holes over the area under study and the other one from blast hole data belonging to the bench being mined. Both sets contain measurements of the total copper grade, but cannot be unified because the quality of measurements is different: blast hole data suffer from greater sampling errors (due to the sampling protocol) and are made on a greater volumetric support (the diameter of a blast hole is about four times that of a drill hole). This is the reason why co-kriging is considered and one looks for a linear model of coregionalization between drill hole grades and blast hole grades. Here, sampling is totally heterotopic, i.e., the sets of blast hole and drill hole data locations are disjoint. As this type of sampling does not allow the calculation of cross variograms, we will use the centered covariance instead ( a nugget effect a spherical variogram with ranges 40 a spherical variogram with ranges 100 a spherical variogram with ranges 150 The application of VARGFIT with weights proportional to the numbers of data pairs and inversely proportional to the prior variances (0.42 for blast hole data and 0.37 for drill hole data) leads to the following coregionalization matrices ( One recognizes that blast hole grades have a higher nugget effect than drill hole grades, corroborating that sampling errors are larger in the former than in the latter. Because of the absence of collocated measurements from both datasets, the nugget effect of the cross covariance is null (Eq. The convergence of the algorithm is faster than in the previous example (34 iterations), with a weighted sum of squares ( We now consider the problem of fitting a linear model of coregionalization in which the simple variograms have a unit sill, while the sills of the cross variograms remain free of constraints (other than that of positive semidefiniteness of the coregionalization matrices). Such a restriction on the simple variogram sills arises when using the correlogram or the standardized variogram as the structural tool, or when working with standard Gaussian random fields in view of multi-Gaussian co-kriging or co-simulation. Without loss of generality, in the remainder of this section, we shall assume that all the basic variogram models { Let The proposed algorithm consists of the following steps:   Calculate Select an index Simulate a Gaussian random vector Define a matrix Calculate If  Go back to Note that a simulated annealing approach to fit a linear model of coregionalization has already been proposed by it uses the GV non-heterotopic criterion (Eq. it does not consider the restriction on the sills of simple variograms; in the iterative step, the perturbation consists in modifying one parameter of the current coregionalization model (sill or range) by addition of a uniform random variable. This perturbation is rejected if it leads to a mathematically inconsistent model (negative ranges or non-positive semidefinite coregionalization matrices). In contrast, in our proposal, the perturbation automatically leads to positive semidefinite coregionalization matrices (Eq. Another iterative approach proposed by A critical aspect of simulated annealing is the cooling schedule, i.e., how the temperature decreases with the iteration number. Various schedules have been proposed in the literature of simulated annealing (e.g., Geometric schedule:  Logarithmic schedule: Also, to allow for small perturbations, which is of particular interest when the system is close to the global optimum, it is convenient not to simulate an independent Gaussian vector As for the GV algorithm, it is easy to adapt the proposed simulated annealing algorithm to the fitting of centered and non-centered covariances instead of variograms. Suppose that we wish to fit the variograms of a set of stationary standard Gaussian random fields. Because the distribution of each variable has been transformed to a standard normal distribution, it is of interest to impose that all the simple variograms have a unit sill. The proposed simulated annealing algorithm has been implemented in the Matlab routine MGFIT provided together with this article. The inputs and outputs are the same as for program VARGFIT, except that here there is no need to specify the prior variances of the Gaussian random fields because they are assumed to be equal to 1. The implementation considers a geometric cooling schedule (Eq. To illustrate the potentiality of program MGFIT, let us come back to the grade data presented at a nugget effect an exponential variogram with ranges 9 an exponential variogram with ranges 30 a spherical variogram with ranges 80 The fitted variograms are displayed in As expected, the sills of the simple variograms are exactly equal to 1, while those of the cross variograms are less than 1 because of the Cauchy–Schwarz inequality (the total sill matrix The truncated Gaussian and plurigaussian models ( a vector random field in a partition of A categorical variable with We will make the following simplifying assumptions: For  The random fields The independence assumption (b) allows separating the definition of the partition and the fitting of the spatial correlation structure. Indeed, the probability that vector In order to gain generality, we do not make any assumption on the number of Gaussian random fields ( The model depends on the particular choice of the partition ( one does not avail the sample covariances or variograms of the Gaussian random fields, but only that of the facies indicators; the covariance functions Because of these two restrictions, the GV algorithm is not applicable. An adaptation of the simulated annealing proposed in Let us assume that the covariance functions  The Levenberg–Marquardt algorithm requires initial values for the parameters (entries of The solution to the least squares problem may not be unique and convergence to the global minimum is not ensured. For instance let us consider two independent Gaussian random fields  Then, for We will consider the case study presented in Gravel: Oxide: Leached capping: Secondary sulfide: Primary sulfide: The indicator simple and cross variograms of the domains have been computed along the horizontal and vertical directions (file According to the a cubic variogram with ranges 50 a cubic variogram with ranges 150 a cubic variogram with ranges 700 a cubic variogram with ranges 1500 a cubic variogram with ranges 25,000 and the following truncation thresholds: As an initial guess, we use the default initial matrix Three iterative algorithms have been proposed for fitting a coregionalization model: a modified version of the GV algorithm for fitting a model with unknown variogram sills; a simulated annealing algorithm for fitting a model subject to a constraint on the sills of the simple variograms; and a nonlinear least squares algorithm for fitting a plurigaussian model. All these algorithms aim to minimize a weighted sum of the squared differences between sample and modeled variograms, and are adapted to heterotopic situations for which the sample variogram matrix at given lag vectors may be partially unknown. Convergence to a solution has been observed in all the presented case studies, although the algorithms may fail at finding the global optimum (depending on the cooling schedule or the initial guess, they may be trapped in a local minimum). The provided computer programs are versatile and are not restricted in the number of variables, nested structures, sample variogram lags or directions. They are expected to be helpful in the modeling of coregionalizations for which the number of variables is too large to consider a manual (trial-and-error) variogram fitting, and are advantageous over existing algorithms in the case of highly heterotopic datasets or when dealing with specific coregionalization models such as the multi-Gaussian and plurigaussian models. Of course, the experience and knowledge of practitioners are necessary to judiciously use the proposed tools, to prevent under- or over-fitting and to avoid an inadequate choice of the basic nested structures or of the plurigaussian truncation rule. In this sense, automated or semi-automated procedures cannot replace practice for interpreting and modeling variograms ( This research has been funded by the Chilean Commission for Scientific and Technological Research (CONICYT), through FONDECYT Project no. 1090013. The author is grateful to the anonymous reviewers for their constructive comments that helped to improve the manuscript. Supplementary data associated with this article can be found in the online version at 