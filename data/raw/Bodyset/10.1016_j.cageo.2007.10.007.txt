A Matlab program (TBCOSIM) is provided for co-simulating a set of stationary or intrinsic Gaussian random fields in 
                        
                           
                              
                                 
                                    R
                                 
                              
                              
                                 3
                              
                           
                        
                     , whose simple and cross-covariance functions are fitted by a linear model of coregionalization. It relies on the turning bands method, which performs three-dimensional simulation via a series of one-dimensional simulations along lines that span 
                        
                           
                              
                                 
                                    R
                                 
                              
                              
                                 3
                              
                           
                        
                     . There is no restriction on the number of random fields to simulate, on the number of basic structures used in the coregionalization model, and on the number and configuration of the locations where simulation has to be performed. Additionally, the realizations can be made conditional to data, back-transformed and averaged over a block support. TBCOSIM uses parallel simulation algorithms: at each location, the random fields are simulated simultaneously and a single co-kriging is needed for conditioning all the realizations. The capabilities of the program are illustrated with the analysis of a set of non-conditional realizations and with an application to a soil contamination dataset.Many disciplines in the geosciences are concerned with the characterization of co-regionalized variables monitored at sampling locations. Examples of applications include the evaluation of recoverable resources in polymetallic deposits, the modeling of the petrophysical properties of a reservoir or an aquifer, the remediation of soils polluted by heavy metals, or the prediction of soil properties for agricultural land management. In this context, practitioners may be interested in predicting the values of the coregionalization over a given domain or in assessing the uncertainty attached to these values, either at a single location or jointly over several locations. The prediction problem can be solved by using co-kriging methods ( A variety of algorithms have been proposed in the literature. Although some of them provide perfect simulations of Gaussian random fields, they suffer from limitations concerning the number or the spatial configuration of the locations where these random fields can be simulated. For instance, the discrete spectral algorithm proposed by To avoid such limitations, some approximations are required. In this respect, one can distinguish algorithms that generate Gaussian random fields with covariance functions that differ from the desired model, and algorithms that do not generate Gaussian random fields, although the covariance model may be accurately reproduced. In the first category, one finds algorithms based on a discretization of continuous spectral representations ( The second category of approximate algorithms includes the continuous spectral and the turning bands methods. The former ( Among the available softwares for co-simulating Gaussian random fields, the turning bands program proposed by A difficulty with the simulation of co-regionalized variables is the requirement for cross-covariance functions that model the relationships between the different variables. Let us consider a stationary vector random field There exist several approaches for modeling the simple and cross-covariances, e.g.: Markov-type model ( Intrinsic correlation (also known as “intrinsic coregionalization” or “proportional covariance model”) ( Linear model of coregionalization ( Bilinear model of coregionalization ( Use of spectral representations ( Models based on the square roots of covariance functions ( Models induced by relationships (e.g. partial differential equations) between the variables ( Because of this diversity of covariance modeling approaches, it seems difficult (if not impossible) to design an all-purpose co-simulation algorithm. In this paper, we will focus on the To broaden the scope of this work, the stationarity hypothesis will be weakened by considering the more general model in which ( For Let The simulation of a Gaussian vector random field with cross-correlated components ( To produce realizations conditioned to a set of data, a supplementary step is required. In the univariate case, this is done by adding a non-conditional realization and the kriging of the difference between the data values and the simulated values at the data locations ( Several comments are worth being made: The co-kriging weights needed in Eq. Care must be taken in the design of the co-kriging neighborhood. Over-restricted neighborhoods (with small search radii and few conditioning data) often introduce discontinuities in the simulation maps, which can be spuriously considered as part of the spatial variability of the coregionalization, and provoke a loss of precision and an increase of conditional bias in the co-kriging estimates ( When a unique neighborhood is considered, the conditioning process (Eq. Co-kriging and co-simulation can be performed with heterotopic datasets, for which not all the variables are known at each data location. Simple co-kriging is used for conditioning the realizations of stationary random fields (those for which the covariance functions have a finite sill) with known mean values. Ordinary co-kriging is used for stationary random fields with uncertain mean values or for random fields with stationary increments (intrinsic random fields of order 0) ( The Matlab program TBCOSIM uses the turning bands algorithm for simulating the components of Use of parallel algorithms: at each location, the Use of continuous simulation algorithms along the lines, which avoids discretizing the 1D simulations and allows reproducing the simple and cross-covariances of No restriction on the number of nested structures used in the linear model of coregionalization. Each structure can have a geometric anisotropy defined by three angles and three scale factors, following GSLIB conventions ( The convergence of the simulated distributions to multivariate normality is controlled by the number of lines used to simulate each nested structure. Suggestions for choosing this number have been given by Post-processing options: the realizations can be back-transformed from the Gaussian unit to that of the variables of interest by specifying a set of transformation tables and parameters for tail extrapolation, following the approach proposed by  Also, the realizations can be averaged over a block support, via a discretization of the block. TBCOSIM can be run directly in the Matlab workspace with its input arguments (see the program file for details). Alternatively, it can be used with a parameter file: in such a case, no input is needed and the user is prompted for the name of the parameter file (by default, TBCOSIM.PAR) ( TBCOSIM uses 12 sub-routines: BACKTR: back-transform from Gaussian to original scale. COKRIGE: compute co-kriging weights (moving neighborhood). COVA: compute covariance values. CREATE_PARAMFILE: create default parameter file TBCOSIM.PAR. DUAL: compute dual co-kriging weights (unique neighborhood). PICKSUPR: build templates of super-blocks (moving neighborhood). SEARCH: search for data in a moving neighborhood. SETDUAL: compute right-hand side of dual co-kriging system. SETROT: set up rotation matrix to transform Cartesian coordinates. SUPERBLK: set up super-block strategy (moving neighborhood). TBMAIN: perform non-conditional simulation along the lines. VDC: generate equidistributed lines over the unit 3D sphere. In this section, we consider the non-conditional simulation of a pair of Gaussian random fields over a 200×200 grid. The coregionalization model consists of a nugget effect, an isotropic spherical structure with range 50 and an isotropic Matérn (K-Bessel) structure with scale factor 10 and shape parameter 2: For the simulation of each nested structure, 1000 lines are used in the turning bands algorithm. To validate the quality of the realizations, two questions can be asked: Do they conform to the above linear model of coregionalization (Eq. Do they conform to a vector random field with multivariate normal distributions? Concerning the first question, a simple validation exercise consists in examining the sample variograms of the realizations: on average over many realizations, they should match (up to reasonable statistical fluctuations) the prior variogram model. The results obtained for 100 realizations ( the recourse to a moving neighborhood for conditioning co-kriging may introduce spurious fluctuations (recall second comment in the conditioning data may not exactly conform to the coregionalization model; even so, the simple and cross-variograms of the conditional simulations usually differ from the prior variogram models, unless the simulation domain is very large with respect to the domain surrounding the conditioning data. Put another way, the data introduce a “distorsion” with respect to the prior model ( As for the second question (multivariate normality), the validation is often limited to the bivariate distributions. One option is to examine the sample indicator variograms for some quantiles and compare their averages over the realizations with the corresponding prior models ( To illustrate the importance of the co-simulation approach in multivariate problems and the capabilities of program TBCOSIM, a case study is now presented. We will consider a dataset from the Swiss Federal Institute of Technology that consists of 359 measurements of heavy metal concentrations (cadmium, cobalt, chromium, copper, nickel, lead and zinc) in the topsoil of a contaminated site in the Swiss Jura. The site covers approximately 1450 The goal of the study is to assess the risk that the contaminant concentrations exceed regulatory thresholds, in order to delineate the areas where cleanup is needed. We will assume that the remediation units are blocks with size 20×20 The study consists of the following steps. Transform the original data (metal concentrations) into normal scores, accounting for declustering weights to correct for the irregular sampling design. In the present case, the weights have been obtained by the cell declustering technique ( Calculate the sample (simple and cross) variograms for the normal scores data and fit a linear model of coregionalization. A nugget effect and two nested isotropic spherical structures, the first one with a range of 0.4  Check for bivariate normality by examining the indicator variograms at some specific thresholds, see Perform conditional co-simulation of the metal concentrations over the remediation units, with the normal scores data and the fitted coregionalization model as input in TBCOSIM. The following parameters are considered: discretization of remediation units set to 6×6 points; simulation of each spherical structure based on 1000 lines; conditioning by ordinary co-kriging; definition of a moving neighborhood with a radius of 1.5 generation of 100 realizations. As an illustration, the maps of contaminant concentrations corresponding to the first realization are shown in For each remediation unit, evaluate the probability that the three metal concentrations are below the regulatory thresholds:  (concentrations and thresholds in Eq.  The hazard probability calculated by considering the variables independently tends to overstate the probability obtained by accounting for the cross-correlations between these variables, as corroborated in The probability maps in Many geostatistical simulation algorithms are still limited in multivariate situations, especially in what refers to the reproduction of cross-correlations between variables. In this paper, a Matlab co-simulation program (TBCOSIM) has been presented, which offers the following features: 3D simulation, either at gridded locations or scattered locations; no restriction on the number of these locations; no restriction on the number of nested structures; no restriction on the number of variables; handling of heterotopic datasets (variables known at different locations); use of stationary and intrinsic models; conditioning of the realizations to a set of data, using: simple, ordinary or intrinsic co-kriging; unique or moving neighborhood; availability of the most commonly used covariance models; back-transformation from normal values to original units; change of support (regularization) of the realizations. The main advantages of TBCOSIM are the parallel procedure, in which all the variables are simulated simultaneously and a single co-kriging is used to condition all the realizations, and the avoidance of discretization for the simulation along the lines, which allows reproducing the simple and cross-covariances exactly and performing simulation at irregularly spaced locations in The drawbacks stem from the restrictions imposed by the choice of the random field model: multivariate normal distributions, simple and cross-covariances fitted by a linear model of coregionalization. The latter is widely used in spatial analysis, but may turn out to be insufficient for analyzing temporal or spatio–temporal data, as it excludes deferred correlations (delay effects). Program TBCOSIM can however be adapted to simulating more general models, e.g. Gaussian random fields with covariances fitted by a bilinear model of coregionalization that allows delay effects between the variables ( This research was funded by the National Fund for Science and Technology of Chile (FONDECYT) and is part of Project 1061103. Supplementary data associated with this article can be found in the online version at 