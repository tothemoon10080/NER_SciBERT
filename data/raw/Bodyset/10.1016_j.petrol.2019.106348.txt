In the gas lift, gas injection rate has an optimum value and increasing or decreasing its amount decreases the oil production rate. This optimum point changes in production time and creates an optimum trajectory. There has previously been much research in this area, but none have used a powerful tool in a dynamic model to find a good optimal path for maximizing the production or NPV in a gas-lifted field. In addition, gas allocation in a time step changes the production of different wells and the pattern of fluid flow and also reservoir pressure decline in the reservoir. This can affect the optimum gas allocation of the next time step, but this has not been analyzed in any of the previous works. In this paper, first, a model of reservoir and well of a gas lift well is developed and using some experimental data points the best-fitted correlations are selected. Then, two common and famous heuristic algorithms (genetic algorithm, simulated annealing), and two recently introduced optimization algorithms (Moth Swarm Algorithm and Grasshopper Optimization Algorithm) are used to find the optimal path of the injection lift gas rates of the wells. Finally, the results of these four algorithms are compared with each other and some other allocation scenarios. In addition, different aspects of the injection and production rates of the different wells and their cumulative rates and NPV paths are analyzed. The results illustrated that using MSA has an optimum point with higher production. In addition, MSA finds a specific control path with a need for lower lift gas and also a smaller compressor. It also has a really different control path with other optimization algorithm paths. In addition, in this paper, a new long term instability in flow is observed, which was explained by the drainage area of each well. This control path of each well was discussed and it was concluded that GA can find the most stable path.As the production of the reservoir continues, the reservoir pressure drops and causes the oil rate to be reduced. This reduction continues until the production oil rate falls below the economic rate. In this situation, using artificial lift methods is necessary ( Another problem is that as the production continues the reservoir pressure decreases and one of the parameters for specifying the optimum gas allocation is the reservoir pressure. In other words, the optimum combination of injection rates of the wells of the current time is not the optimum combination of the injection rates of the future of that field ( In this paper, in addition to the above points, the most recent optimization algorithms are used to find the best injection trajectory for the wells of a field. Afterward, the effect of different gas allocation on the production of well, reservoir pressure loss patterns and the behavior of reservoirs in the future has been discussed and the reservoir near wellbore instability has been introduced. This complete analysis has not been published until now in any paper and can be a great help for future studies. In 2004, Bin and In 2012, As can be seen in most of the previous works, gas lift control has concentrated on preventing instability not to maximize the net profit. In only a few researches, the net profit has been considered and on these researches, the purposed model is not dynamic In addition, those studies are just an optimization in a time point, not the real-time optimal control. Here in an optimal control of a gas allocation problem, the NPV of each time step will be maximized. Another problem is that in all of the previous works of gas lift control, the modeling of the system is very weak. They have only used some simple models of mass balance and have ignored the fluid dynamics, which is a huge source of error. Here the model will be created using complex correlations, which consider the different aspects of fluid flow dynamics and by analyzing the performance of the correlations, the best ones will be selected. Also, all controllers of the previous researches are simple ones with low efficiencies but here the most recent optimization algorithms will be used and their results will be compared with previous works. The last point is that in all previous works, the effect of the reservoir on the production was not considered, but here the effect of reservoir and the production history on reservoir pressure is considered and the optimal control is run based on reservoir pressure drop (resulted by previous time step production) in a long term model. In the next part, first a model will be developed and then using the most recent optimization algorithms, it will be optimally controlled. First of all, a model is developed for the gas lifted field. For this means, models of 5 wells that have been drilled in a reservoir are used. It is assumed that only these 5 wells are produced in the reservoir and there is no sand production in any of the wells. The PVT properties and the characterization of wells and reservoir are in the range of Iranian oil fields. The reservoir model is a synthetic model with a high degree of heterogeneity. This heterogeneity is assumed for a better illustration of the effect of different situations of the reservoir on the gas allocation and generalizes the case study of this paper. Thus, the API of the produced oil is changed such that the response of every well to the lift gas injection rate is different and the effect of gas allocation is better shown in a long time period. In addition, different water cut and GOR are assumed to ensure that the optimization has the least dependency on the model. The data of the wells and the reservoir are in the range of Iranian reservoirs. This model consists of three parts. The first part is about the modeling of the wells. Different properties of the wells of the model of this study are listed in As can be seen in All wells are in a reservoir, it is clear that the production of any well will cause the whole reservoir pressure to decline. However, its decline will not have the same effect on all wells. Of course, its effect is greater in a well with production. For creating the model, the previously introduced correlations for PVT properties and the two-phase flow are used. There are various correlations for different PVT properties, for example critical pressure and temperature ( There are measured PVT properties in the lab for one point pressure (2200 psi). At this pressure, the solution gas ratio was 255 STB/day, Bo was 1.32 and oil viscosity was 0.4 cp. To find the best experimental correlation, different correlations have been plotted and their prediction has been compared with the experimental point. As the number of experimental data points be more, the model selection is more efficient, but unfortunately, just one experimental data point was available and that was used in the selection process. It should be noted that for some other properties the data points of As can be seen in After simulating the wells there is a need for reservoir simulation. The porosity of the reservoir is 0.26 and the permeability of the reservoir is considered as 40 md. The initial static well pressure of each well can be seen in This study has focused on gas allocation optimization between some gas lifted wells. In that, a fixed amount of lift gas will be allocated between all gas lift wells. It should be mentioned that total amount of available life gas is not huge in this study and the injected lift gas is recovered by produced oil (except a small amount in which may be lost because of the leakage of the instruments), Thus, no matter which season is (cold or hot) the process can be continued with a constant amount of total lift gas. As the gas lift is a well-based phenomenon, this study is concentrated on the well model, not on the reservoir model. Thus, a synthetic model of a highly heterogeneous reservoir is assumed to include different reservoir situations and fluid and rock properties to the problem. The average reservoir pressure is about 4000 psi. It is assumed that the reservoir is not producing long enough to stabilize the pressure at different points and all wells are producing in fixed tubing head pressure. The tubing head pressure for different wells is different, but it is between 1600 and 2000 psi. Then, in the first time step, using the optimization algorithm, the optimum injection rate is calculated and based on their corresponding production rate of different wells and using material balance and superposition, the performance of the reservoir in the drainage area of different wells is calculated and then using Vogel the IPR curve is calculated. Afterward, the well model is developed. In the well model, knowing the tubing head pressure and using the multiphase flow models, the flow rate of the fluid based on bottom hole pressure is calculated. In developing the well model, the well is divided into some sections in which, in each section, the area of flow and the gas oil ratio are fixed. Thus, the points in which the flow path area changes or the lift gas is injected are placed between two adjacent sections. The flow rate of each gas lifted well is calculated by this model and the IPR model. After that, considering the price of oil, gas and the cost of water disposal and other CAPEX and OPEX, the cash flow is calculated. This whole process for finding the cash flow is the fitness function of the optimal control. Then using the fitness function, the optimum injection rate of the time step is calculated by using the corresponding oil rates of the wells with the lift gas injection rate. Then the pressure distribution of the reservoir at the end of the production of that time step is calculated and this pressure is considered as the pressure of the drainage area of the wells of the next time step and so on. After the model is completed, there is a need to see the production oil rate of the wells at different time steps. Thus, based on Different correlations are tested on the model and finally, the model is created. Now it is time to apply the optimal control method on it. In every optimization and optimal control problem, a fitness or performance function should be defined. This function is desired to be maximized or minimized. In gas allocation problems, it can be the cumulative oil production or net present value (NPV) ( In the above equation, P stands for the price and q stands for the rate and the subscripts ‘o’, ‘g’ and ‘w’ show the oil, gas, and water, respectively. Of course, the money that is gained sooner has a higher value than the equal amount of money that is gained later. Thus, the discount rate is defined and used here. In addition, to calculate NPV there is a need to include the CAPEX in the calculation. CAPEX is any cost for beginning the process ( In the above equation, n is the number of time steps and tf is the total number of time steps. r is the discount rate and The model and the fitness function (NPV equation) are ready. It is time to use an optimizer to maximize the fitness function value on every time step or in other words control the gas allocation to maximize the profit. However, before that, some other specification of the problem should be stated. Every model has some assumptions and every optimization problem has its constraint. These will be stated here: Model assumption: The downhole and surface facilities are pre-designed and are not changeable during the simulation and control and no new well is drilled in this period. There is not any gas cap in the reservoir and no water conning occurs near any wells. No well repair is done during the simulation. No well has sand production and no well has the skin any time during the simulation process. All wells produce in constant tubing head pressure. Optimization constraints: The main optimization constraint is the total amount of available lift gas which is allocated between different wells. In other words, the total injected gas of all wells should be smaller or equal to the total amount of available lift gas. The lift gas rate of each well must be a non-negative number. It is clear but it should be defined in the optimizer. The oil rate of each well should be higher than a minimum (here the minimum is assumed as the 500 bbl/day and is satisfied without any problem). There are various optimization algorithms including numerical and heuristic ones. However, due to the complexity of the problem, using heuristic algorithms are much more suitable. Numerical algorithms cannot work well in problems with complex nature, but heuristic algorithms can do that much more easily. In numerical optimization algorithms a (some) straight forward equation(s) (linear, polynomial and etc) are required but in the problem of this study the oil rate is not calculated straightforwardly at all it is calculated as below: First, it needs to assume an oil rate, then the oil well to be divided into some sections and in each section using a long trial and error the pressure and temperature are estimated. Then using the value of pressure and temperature of the above section and using another trial and error the pressure and temperature of the lower section are calculated, this calculation continues until the lowermost section pressure, downhole pressure, for a specific production rate is calculated. All these calculations should be repeated for other assumed production rates and finally, the result of the production rate versus downhole pressure is plotted. This graph is crossed over by reservoir performance and finally, the production rate is found. As can be seen, this process is very long and complex and cannot lead to a single simple equation which can be used in numerical optimization. In addition, even if an equation was available, it would have been such a complex one with a lot of variables (especially if in another example more wells be considered) that using numerical models on that would be impossible. Thus using numerical optimizer is impossible and there is no other option just using the heuristic optimization. Heuristic optimization regardless of the complexity of the model (or if it is a black box model) and the number of inputs (here wells) can work efficiently. Here, two of the most recent heuristic optimization algorithms are used and their results are compared with the genetic algorithm and simulated annealing. These algorithms will be explained in the proceeding parts. Moth swarm algorithm ( This algorithm is summarized in The Grasshopper Optimization Algorithm ( Simulated annealing is an optimization algorithm, which has been developed based on the creation of crystals by the cooling of melted materials. It has been widely used in different course areas such as computer engineering ( One of the most common heuristic optimization algorithms is the genetic algorithm, which is inspired by the natural selection of Darwin. It is widely used in different areas of science and engineering such as enhanced oil recovery ( In this study, the gas injection rate of each well is a gene and an array of injection rates of all wells is a chromosome. The corresponding NPV value of each array of injection rates in a time step is the fitness of that chromosome. As mentioned for previous algorithms, in this study the optimizer is used to allocate a limited amount of gas between wells such that the total amount of oil production is maximum at any time. For this purpose, the simulation time is divided into 20 time steps and in every time step, the optimizer finds the best gas allocation between times. The lift gas injection rate in the created model of the gas lift field is controlled using the four explained optimization algorithms to maximize the net present value. As in the explanation of each algorithm, each algorithm has some internal parameters. For example, the population size is common in most heuristic algorithms and in this study, it is assumed to be 20. Other parameters of each algorithm are listed in After running different optimizers, the results are discussed. However, before that the sensitivity of wells to gas lift injection rate should be discussed. For this purpose, well 5 is selected as a sample and assuming different reservoir pressure its oil production rate vs lift gas injection rate is plotted. The result is shown in  When a constraint such as maximum available lift gas is assumed and a limited amount of gas is allocated between wells, finding an injection rate to maximize the production oil rate is not as easy as As More details about the Iterations of all times steps are shown in In addition, Now, after investigating the convergence of the optimizers, the results of different optimization algorithms over all time steps will be discussed, as shown in  As mentioned, It is stated that the results of cash flow by using different optimizers are similar.  This figure shows the oil production of each well during the simulation. In this figure, gas is injected in optimum allocation found by MSA, which has the maximum oil production. In this figure, well 3 has the most production. From the beginning to the end, its production is higher from other wells. Also, it has a high decline in production rate. Well 4 has the lowest production rate. In the beginning, it has a high decline rate and in about month 10, its production decline rate decreases. However, its production is not high. Other wells have a medium production and their decline rate is slow. The only intersection between rates of different wells is between well 1 and 4. At the beginning of the production they had a similar rate, but after a while, the production of well 4 highly declined. Now is the time to compare the injection rate profile, which is suggested by different optimizers, as shown in Of course, After discussing the path of injection and production and cash flow and observing some similarities and differences, it is better to investigate the cumulative properties of the problem. In Now the question is whether the total oil production of wells in different optimization algorithms are similar or not.  The control path of most algorithms in this study was similar, but for MSA it had a base difference because, in addition to having a higher production rate and cash flow, the reservoir pressure decline pattern is also different when MSA is applied. Also, despite the higher production, MSA finds a path in which maximum lift gas usage was much smaller than other algorithms, meaning that the use of this algorithm requires a smaller compressor and the capital cost decreases. The control path that MSA found was great and very different from other optimization algorithms. In a simulation of this paper, it is observed that in some algorithms the allocation was such that it causes a high production of some wells in some time steps and thus the near wellbore pressure loss, which caused the low productivity in the next time step and thus when it has the less injection gas share, other wells take more gas and this process was repeated for other wells and so on. This process in this paper is called near wellbore instability. Near wellbore instability, which was introduced in this paper causes high oscillation in the injection and production of wells. It needs injection choke size to be changed during time steps and higher production pipe diameter etc. In this study, GA could find a more stable control path. Comparing the stable and unstable control path found by different algorithms showed a small and ignorable profit loss. In comparison to reducing the repair and maintenance cost, there was no need for a production pipeline with higher diameter and reducing probable production cease of some wells make the stable path really profitable. As mentioned beforehand, the control path that MSA found was basically different from other algorithm paths, which causes higher NPV by requiring a smaller compressor (and also less consuming energy) with respect to other algorithms. This study can be extended by testing MSA in other problems with a higher number of wells and problems with more constraints to see its application. In addition, other algorithms can be used to see whether better control paths (even better from that of MSA) can be found or not. The following is the supplementary data to this article: Supplementary data to this article can be found online at