Model Predictive Control (MPC) is an advanced technique for process control that has seen a significant and widespread increase in its use in the process industry since its introduction. In mineral processing, in particular, several applications of conventional MPC can be found for the individual processes of crushing, grinding, flotation, thickening, agglomeration, and smelting with varying degrees of success depending on the variables involved and the control objectives. Given the complexity of the processes normally found in mineral processing, there is also great interest in the design and development of advanced control techniques which aim to deal with situations that conventional controllers are unable to do. In this aspect, Hybrid MPC enables the representation of systems, incorporating logical variables, rules, and continuous dynamics. This paper firstly presents a framework for modeling and representation of hybrid systems, and the design and development of hybrid predictive controllers. Additionally, two application examples in mineral processing are presented. Results through simulation show that the control schemes developed under this framework exhibit a better performance when compared with conventional expert or MPC controllers, while providing a highly systematized methodology for the analysis, design, and development of hybrid MPC controllers.Model predictive control (MPC) refers to a class of computer algorithms for process control that rely on the use of dynamic models to make predictions of the evolution of the process. Using this predictions, a MPC algorithm performs an optimization of predefined control objectives to compute the control sequence needed to drive the process to the optimal operating point. Only the first action in the control sequence is sent into the plant, and the optimization is repeated on the next control interval with the most recent state information ( Predictive control is being increasingly applied in the process industry, mainly due to its ability to handle multi-variable plants naturally and incorporate constraints on operating variables ( In the mineral processing industry, several applications of MPC can be found for the individual processes. For instance, The organization of this paper is as follows. Even though PID controllers are the most usual approach to feedback control found in mineral processing plants ( In Similarly, several applications of model-based control for the processes of granulation, flotation, and froth thickening can be found. A linear MPC scheme was developed by Most conventional MPC strategies use linear models to characterize the dynamical systems to be controlled. While these linear models may provide an accurate representation in the vicinity of an operating point, if the controlled system deviates from the operating point, the accuracy of linear models will decrease, lowering the performance of the controller. In highly non-linear systems, linear approximations may not be sufficiently accurate to represent the real process. Additionally, conventional MPC strategies are unable to represent logical variables such as discrete events or rules. To address these issues, hybrid MPC is used. Hybrid dynamic models are used to describe the evolution of dynamic systems that present both continuous and logical components. Several subclasses of hybrid systems are found in the literature: Linear Complementarity (LC) systems, Mixed Logical Dynamical (MLD) systems, PieceWise Affine (PWA) systems, among others. PWA systems are a composition on linear time-invariant dynamic models that can approximate non-linear dynamics with arbitrary accuracy by increasing the number of linearization at appropriate operating points ( MLD systems are a class of hybrid systems where physical laws, logic rules, and operating constraints are interdependent ( The MLD system representation is useful for expressing several types of systems involving discrete variables, as shown in Under some assumptions, PWA systems and MLD systems are completely equivalent. A well-posed PWA system, that is, In this study, PWA systems were used to develop hybrid models of mineral processes via piecewise linear identification. When considering real processes, such as the ones found in a mining plant, there are two main situations where hybrid models may be applicable, namely, the presence of variables that are intrinsically discrete, such as on-off switches, speed selectors, and number of active units; and the use of piecewise linear models to approximate nonlinearities. Both these situations can be accurately represented using PWA models. Once the PWA system was formulated, an equivalent MLD system was obtained. To find the MLD representation, the HYbrid System DEscription Language (HYSDEL; see The PWA models developed in this study, as described in The next section describes the implementation of the predictive controller for hybrid systems based on the MLD representation Hybrid model predictive control has been successfully implemented in several areas. In When dealing with hybrid system, conventional MPC controllers must be reformulated to account for the discrete variables introduced in the MLD representation. The resulting HMPC controller is able to calculate control laws considering both continuous and discrete variables. One of the advantages of the MLD representation is that the inequalities in To derive the HMPC, an objective function representing the control objectives was proposed: Given the objective function The constraints in the optimization problem Since the optimization problem The MLD model The optimization problem Using Considering the representation Auxiliary variables The optimization problem presented in As mentioned previously, in the formulation of the hybrid predictive controller future states and outputs are expressed recursively in terms of the current state. Conventional estimators, such as the Kalman filter, cannot be used as they cannot incorporate discrete variables directly in their formulation. A hybrid state estimator was implemented, based on the one presented by The discrete variable The filter bank is composed of conventional Kalman filters matched to each mode by its matrices The mixing probability represents the probability that mode The mode probability Having computed the initial condition, each Kalman filter updates its estimates using the current measurement In the previous equation, Finally, the estimated continuous state of the hybrid system and estimated active mode are given by Several alternatives for hybrid model predictive control are available. One of such alternatives is the Multi-Parametric Toolbox 3.0 ( The framework (available online for download The main features of the HMPC framework are Design and implementation of conventional or hybrid predictive controllers. Definition of custom affine constraints. Customization of limit constraints and weights. Run-time adjustment of manipulated and controlled variable reference. Constraint relaxation when problem is unfeasible. Thanks to the way the objective function The framework has been successfully implemented for the design and development of four HMPC strategies for mineral processing, tested through simulation. When the controllers developed using the framework are compared with conventional control schemes based on PID control, expert control, and model-based control, the hybrid controllers exhibit a better performance. More importantly, the framework offers a highly systematized methodology for the design, implementation, and evaluation of these controllers. In this section, two implementations of the hybrid control framework in mineral processing are presented. All the applications were designed and tested through simulation.  A dynamic simulator was developed to implement the models for the crushing plant. The units modeled are cone crushers, vibratory screens, conveyor belts, and storage units (stockpile, silo, and bins). Mineral flows, modeled as particle size distributions, were used to connect the inputs and outputs of the units. The cone crusher model consists in Specific energy consumption in the cone crusher was modeled using Bond׳s law ( The vibratory screen model was based in the model developed in The conveyor belt model, described by For this plant, hybrid controllers were developed for the sections that included hybrid components, namely the signaling light that indicates when a truck can dump its load in the primary crusher, and the position of the tripper cars for tertiary crushing and secondary screening. Primary screening and secondary crushing were not considered as there are no hybrid components in these units. To develop the PWA models necessary for the hybrid controller for primary crushing, the arrival of trucks was considered a random process, which was represented as a discrete variable that indicates when a truck has arrived. A second discrete variable was introduced to represent the signaling light. The PWA model used to represent the primary crushing chamber is defined by Additionally, linear models for specific energy consumption, product particle size (defined as percentage of material passing a 5 Similarly, the PWA model for tertiary crushers is defined by The equivalent MLD models for the PWA models developed for primary crushing, secondary screening, and tertiary crushing can be found in A HMPC was developed for primary crushing, secondary screening, and tertiary crushing. For primary crushing, the manipulated variables are eccentric speed and the signaling light that indicates when a truck can dump its load; and the controlled variables are the accumulated mineral in the crushing bin, specific energy consumption, product particle size, and product mineral flow. Additionally, the discrete variable indicating the arrival of a truck and the mineral feed from the trucks In secondary screening and tertiary crushing, manipulated variables are output flows and tripper car positions, bin levels are controlled variables, and input flows are measured disturbances. In contrast to primary crushing, which aims to maximize the processed tonnage, control for tertiary crushing and secondary screening was designed to ensure a stable operation of the plant. As such, the control goals are to minimize tripper car moves while preventing an overfill of the bins. Additionally, a reference was provided to the output tonnage of each bin to ensure that the sum of the three outputs of tertiary crushing (four for secondary screening) is equal to the input tonnage, while bin levels are allowed to vary in a predefined range. Objective functions that adequately implement these control objectives for tertiary crushing and secondary screening are shown in For the primary crushing controller, the weights and prediction horizon of the objective function were initially tuned manually to achieve a satisfactory performance. A fine tuning was performed afterwards by running multiple simulations with different combinations in the vicinity of the original values, for a total of 1331 combinations. The final weights were chosen from the simulation that produced the best performance indices. For tertiary crushing and secondary screening, the weights and prediction horizon of the objective functions were tuned experimentally to achieve a satisfactory performance. The hybrid controllers were tested against base control schemes. For primary crushing, the base control scheme consists in an expert controller that switches the signaling light based on the level of the primary crusher bin to prevent an overfilling. Additionally, the expert controller acts on the eccentric speed of the crusher, switching between a maximum value when there is enough mineral in the crushing bin to maximize the output mineral flow, and a minimum value when the level of the chamber is below a predefined minimum. There is no coordination between both actions of the expert controller. For tertiary crushing and secondary screening, the base control scheme is an expert controller that determines the position of the tripper car based on level measurements of each bin. First, the controller determines the mean level of the bins, and then finds any bin whose level is less than a predefined threshold below the mean level. If no bin is below this threshold, the tripper car maintains its position. Otherwise, the tripper car is moved to the bin with the lowest levels among the bins below the threshold. Both controllers were simulated on the same control scenario, over 1 For primary crushing, the hybrid controller achieved a 7.7% increase on the processed tonnage, while increasing the specific energy consumption in 1.9%. For secondary screening and tertiary crushing, results show a reduction of the number of tripper car moves by 19% and 17.5%, respectively, while maintaining bin levels around a reference value. From the results, it can be concluded that the HMPC strategy manages to increase the throughput of the primary crushing circuit when compared to an expert solution. Nonetheless, specific energy consumption is also increased as a trade-off, although in a lower percentage. This also reveals one of the advantages of the proposed solution, in that the mentioned trade-off can be adjusted by tuning the weight parameters in the objective function, while in the expert solution the tuning is not so straightforward. As an example, increasing the linear weight for the specific energy consumption in As a measure of the computational effort for the hybrid controllers to find a solution, the mean time required to compute a control action was calculated. The mean computation times are  To simulate the flotation process, a hybrid non-linear dynamic simulator was developed for the flotation line. The simulator considers three operating modes for each rougher flotation cell, determined by the level of pulp and froth. The operating modes identified are No overflow of concentrate. Normal operation with overflow of concentrate. Presence of pulp in overflow of concentrate. To represent the operating modes, two auxiliary binary variables were defined: Mass balance equations The tail volumetric flow was derived from Torricelli׳s law ( The tail grade for cell To develop the PWA models needed for the hybrid controller, a flotation line with three cells was considered. Additionally, the outputs of the PWA model are the level of pulp of the cells and tail grade of the line, while the inputs are the position of the output valves of the cells, the feed mineral flow, and the feed grade. To simplify the identification procedure, only two of the three modes of operation of each cell were considered for the PWA model: presence of concentrate overflow and absence of concentrate overflow. Operation constraints were added to the controller to prevent the plant from entering the third mode, characterized by the presence of pulp in the overflow. A set of data was generated using the dynamic simulator by establishing ranges of variation for the input variables. For each variable, input identification signals in the form of periodic staircase functions of different periods were defined in a way to ensure that there is a maximum number of combinations between the values of these variables. For each cell, two sets of input–output data were generated, one for each mode of operation. Linear identification for the pulp level was performed on each set. Additionally, a PWA model with modes of operation was identified for the tail grade applying a similar methodology. The equivalent MLD models for the PWA models developed previously can be found in A centralized HMPC was developed for the rougher flotation line. The manipulated variables are the positions of the output valves of each flotation cell, and the controlled variables are the pulp levels of each cell and the tail grade of the line. Additionally, the mineral feed flow and feed grade are measured disturbances. Control goals are to minimize the reference error in the line׳s tail grade and to minimize variations in manipulated variables. Lower and upper bounds were implemented for pulp levels and valves positions. An objective function that adequately implements these control goals was defined as The hybrid controller was tested against a conventional MPC controller, which was tuned with the same objective function From Furthermore, it can be seen that the controller effort in this interval is lower for the HMPC strategy, particularly in the step change in the reference value near the 50 minute mark. Outside this interval, the performance of both controllers is practically the same, as mentioned previously. Additionally, from The mean computation time required by the hybrid controller to compute the control action is This paper presents a framework for hybrid model predictive control applied to mineral processing. The hybrid modeling of dynamic systems using the MLD representation, and the hybrid predictive control of these systems through mixed-integer quadratic programming are detailed, and two applications in crushing and flotation are presented. The proposed framework of hybrid systems adopted in this paper offers a highly systematized methodology for the analysis, modeling and development of hybrid controllers for complex processes, as found in mineral processing. When compared to conventional schemes such as model-based control or expert control, where the controller is usually designed to suit the process specifically; the hybrid approach offers a much more flexible structure which can be adapted to any process, regardless of its structure. In industrial processes such as those found in mineral processing plants, the implementation of centralized control solutions is often not possible due to problems such as differences in the dynamics of various processes, availability of computational resources, centralized modeling of the different processes, among others. In such cases, decentralized control strategies have significant advantages. Apart from the relative simplicity to implement controllers for individual processes, the modularity of the solution facilitates maintenance, as well as possible modifications to the system. For these reasons, future work will focus on the design and development of a distributed HMPC scheme to be implemented on decentralized control systems. The objective of this scheme is to provide a coordination between different controllers, minimizing the loss of performance when compared to a centralized scheme. The MLD model for primary crushing is shown below. The manipulated variables and measured disturbances collected in The MLD model for tertiary crushing is shown below. The manipulated variables and measured disturbances collected in The MLD model for secondary screening is shown below. The manipulated variables, measured disturbances, and output variables are the same as in the model for tertiary crushing, with one additional bin: The MLD model for the rougher flotation line is shown below. The manipulated variables and measured disturbances collected in