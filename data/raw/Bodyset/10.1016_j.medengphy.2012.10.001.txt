Accurate alignment of femoral shaft fractures treated with intramedullary nailing remains a challenge for orthopaedic surgeons. The aim of this study is to develop and validate a cone-beam CT-based, semi-automated algorithm to quantify the malalignment in six degrees of freedom (6DOF) using a surface matching and principal axes-based approach. Complex comminuted diaphyseal fractures were created in nine cadaveric femora and cone-beam CT images were acquired (27 cases total). Scans were cropped and segmented using intensity-based thresholding, producing superior, inferior and comminution volumes. Cylinders were fit to estimate the long axes of the superior and inferior fragments. The angle and distance between the two cylindrical axes were calculated to determine flexion/extension and varus/valgus angulation and medial/lateral and anterior/posterior translations, respectively. Both surfaces were unwrapped about the cylindrical axes. Three methods of matching the unwrapped surface for determination of periaxial rotation were compared based on minimizing the distance between features. The calculated corrections were compared to the input malalignment conditions. All 6DOF were calculated to within current clinical tolerances for all but two cases. This algorithm yielded accurate quantification of malalignment of femoral shaft fractures for fracture gaps up to 60mm, based on a single CBCT image of the fractured limb.Intramedullary (IM) nailing is the current standard of care for the treatment of femoral shaft fractures due to its low infection rates and high union rates The current clinical tolerances reported in the literature for malalignment of the reduced fracture range from 5° to 10° varus/valgus and 10° flexion/extension angulation, 15° periaxial rotation, 1 to 1.5 To aid in conventional (non-navigated) reduction alignment, multiple, fluoroscopy-based techniques have been proposed in the literature, for leg length, angulations and periaxial rotation Current navigation methods require the surgeon to select landmarks on bi-planar fluoroscopic images (an anterior/posterior and a lateral), from which a 3D coordinate is calculated With the pairing of flat-panel detectors to cone-beam computed tomography (CBCT), the ability to acquire fast and high-resolution (sub-mm, isotropic voxels) 3D images intraoperatively has become available The objective of this study is to develop and validate a semi-automated algorithm that can quantify the malalignment of femoral shaft fractures in 6DOF using a surface-matching approach combined with the alignment of the principal axes, based on a single CBCT image of the fractured leg. We hypothesize that this method will enable accurate quantification of the malalignment of the inferior and superior fracture fragments in complex femoral shaft fractures with severe comminution. Nine left, dried cadaveric femora (Pacific Research Laboratories Inc., WA, USA) were mounted in a mechanical jig composed of a clamp mounted on a ball joint and six precision stages (Newport Corporation, CA, USA). The proximal femur was secured to the ball joint to enable motion in 6DOF. The precision stages allowed rotations (accurate to 0.5°) about and translations (accurate to 0.05 On each specimen, a length of bone was removed (ranging from 7.5 The precision stages were manipulated to create three unique sets of rotations and translations of the inferior femur with respect to the superior fragment ( The three image stacks and the two surface meshes were loaded into a semi-automated algorithm written in Tool Command Language for AmiraDev 5.1 (Visage Imaging, Carlsbad, CA, USA). An interactive cropping tool was then displayed for the superior and inferior image stacks to be cropped to reduce computational demands and, thus, decrease the time required for the analysis. As the surfaces were created to include only the external bony surface, and not the IM canal, the surfaces were formed as closed fragments. However, subsequent steps of the algorithm required that the surfaces have no end caps, both at the limit of the field of view and at the fracture border. This is important as the ends of the fragments can be angled at the borders of the field of view, thus altering the principal axes of the fragments. As such, a second cropping step was included in which the user was asked to remove the caps from the surface using a 2D plane that could be rotated to be approximately perpendicular to the long axis of the fragment ( As the cross-section of the femur is not cylindrical, the centroid of the femur, within a slice, can be shifted based on surface features (i.e. a thickened cortex, the linea aspera and anatomical bowing of the femur). The principal axis, based on the moment of inertia, is similarly affected by such surface features. As such, a cylindrical axis, which is less sensitive to surface features, was selected based on an initial estimate from the principal axis to define the long axis of the femur, as described below. To align the superior femur with the global coordinate system (as defined by the CT image), an iterative module was created to fit a cylinder within the superior surface mesh. The module provided an estimate of the axis of the superior femoral shaft that was approximately centred within the cylindrical portion of the cross-sections ( To determine the flexion/extension and varus/valgus angulation, using the dot product, the 3D angle between the long axis of the superior cylinder and the inferior cylinder ( The algorithm then prompted the user to select the gap-bordering slices of the superior and inferior fracture stacks. These represent the most distal slice of the superior fragment and the most proximal slice of the inferior fragment that contained a full cross-section of the bone ( As with the superior surface, the cylinder-fit module was then employed to create a cylinder within the centre of shaft of the inferior surface. To determine the medial/lateral and anterior/posterior translational corrections, the difference between the global origin (to which the superior cylinder was aligned) and the centre of the inferior cylinder was determined. The difference in the To quantify the periaxial rotation, both the inferior and superior surfaces were unwrapped by resampling the surfaces about the cylindrical axes along the length of the surface. This was accomplished through the calculation of the distance from each point within the surface mesh of the fragment to the cylindrical axis (the radius to that point) based on polar coordinates Three different methods of aligning the two unwrapped surfaces were developed and investigated ( The second method determined the point with the maximum distance within the most distal slice of the superior fragment and the most proximal slice of the inferior fragment. Again, the inferior fragment was incrementally shifted until the distance between the maximum points on the two surfaces was minimized, which was assumed to be the neutral rotational alignment. The third method mapped the points of both the most distal slice of the superior fragment and the most proximal slice of the inferior fragment. The inferior fragment was shifted until the difference between the profiles of the superior and inferior slices was minimized. The distance by which the inferior fragment was shifted for each of the three methods was converted into the angular correction, based on the circumference of the fragments (which was the length of the unwrapped surface). Although the incremental shifting was not necessary for the alignment of the two surfaces in the first two methods, the three methods were developed based on the same framework and, as such, incremental shifting of the inferior fragment surface was used in all three methods. The calculated values for medial/lateral ( The principal axis-based algorithm was able to accurately quantify the medial/lateral and anterior/posterior translations, the flexion/extension and varus/valgus angulations and the leg length for 26 of the 27 prescribed malalignments to within current clinical tolerances ( Specifically, the difference in the average error between the calculation of the periaxial rotation using the total profile method compared to the maximum-based method and the linea aspera-based method was 10.1° and 11.8°, respectively. Additionally, the maximum errors between the input periaxial rotation and that calculated by the maximum, linea aspera and total profile-based methods were 85.1°, 77.0° and 22.1°, respectively. The 22.1° discrepancy for the total profile-based method occurred for a single fracture gap case of 60 The time required for the user input (to load the images, verify the angle corrections and perform the surface cuts) was approximately 4 The size of the fracture gap had a positive correlation with the error in the anterior/posterior translation and the flexion/extension angulation ( For one of the alignment conditions, the length of the inferior fracture fragment visible within the scan was 29.2 The algorithm presented within this study was able to accurately quantify the malalignment in complex, mid-shaft femoral fractures in 6DOF even in the presence of severe comminution. Three different methods were investigated for the determination of periaxial rotation, in combination with the determination of the other 5DOF: one based on the difference in the total profile of the fracture-bordering edge of the unwrapped surfaces (total profile-based method); a second based on the difference in the location of the point that was the maximum distance away from the centre of the shaft (maximum-based method); and a third based on minimizing the distance between the extended vectors tracing the linea aspera (linea aspera-based method). The performance of the total profile-based method was more highly repeatable and significantly more accurate than the other two methods and, subsequently, was used for the final determination of the performance of the algorithm in 6DOF. Both the maximum and linea aspera-based methods were extremely susceptible to alterations in the positioning of the two fragments with respect to the The final algorithm, using the total profile-based method to quantify periaxial malrotation, consistently calculated the malalignment to within the current clinical tolerances (5–10° varus/valgus and 10° flexion/extension angulation, 15° periaxial rotation, 1–1.5 The accuracy of some of the calculated alignment parameters was affected both by the amount of bone contained in the fracture gap and the length of the fragments that were visible within the scan. This was to be expected as shortened fragment lengths and increased fracture gaps would lead to less information from which alignment would be calculated and would increase the risk of a skewed cylinder fit. Additionally, increased fracture gaps would increase the likelihood of having substantially different morphology in the cross-sections bordering the fracture (similar to that presented in The algorithm presented in this study is semi-automated, in that it requires user input to cut the superior and inferior surfaces so that they were uncapped for the determination of the cylindrical axes as well as unwrapping the surfaces for the surface matching procedure. The high repeatability from the algorithm, however, indicates that, despite not being fully automated, the algorithm is robust and has good potential for translation to the clinical setting. Also, the input required by the user is straightforward and not time-intensive. Overall, the time required by the user for uploading the images, performing the manual surface cuts and verifying the correction of the angulation and translational components within the algorithm is approximately 4 The presented algorithm provides accurate quantification of malalignment in all 6DOF based on one CBCT scan of the fractured limb. The incorporation of this algorithm with the current capabilities in instrument and fragment tracking may provide increased accuracy as well as increased intraoperative information regarding the fracture alignment. The majority of current navigation systems quantify anteversion and leg length but not the other 4DOF. Instead, the medial/lateral and anterior/posterior translations and the flexion/extension and varus/valgus angulations are guided into alignment based solely on the surgeon's judgement from the 2D visualization of the fragment positions as they are tracked based on the initial fluoroscopic images from the registration. The success of the reduction accuracy of these systems has been variable and studies into their performance have been limited. Weil et al. reported an average accuracy of 2.5° for periaxial rotation and 1.9 As such, use of CT-based methods has become an area of interest for femoral shaft fracture reduction. Specifically, surface matching methods have been investigated in two previous studies. Tsao et al. experienced great success in the application of a surface matching protocol for three chicken femora, by unwrapping the surfaces about the principal axis One limitation of this work is the absence of soft-tissue in the scan acquisition and segmentation procedure. However, the diaphysis of the femur is composed primarily of cortical bone and, as such, the intensity-based threshold segmentation is rapid and robust, even in the presence of soft tissue. Additionally, the fracture model used in this study utilized a single-fragment comminution volume, which is a simplification of the various fracture morphologies that are encountered clinically. This design facilitated the inclusion of all comminution fragments within the field of view of the CT scan. Additionally, as the comminution volume in a diaphyseal fracture is composed primarily of cortical bone, the amount of comminuted bone that would be present at sub-resolution sizes and, as such, undetected by the intensity-based thresholding would be negligible. Thus, although this fracture model was idealized, the method would still be applicable for diaphyseal fractures consisting of a multi-fragmented comminution volume. Within the course of this study, the algorithm was not tested to the point of consistent failure for any of the alignment conditions. The fracture gap, minimal length of bone, and fracture alignments were not sequentially altered until the algorithm was consistently incapable of accurately quantifying the fracture malalignment. Although two of the fracture conditions did result in inaccurate performance (one due to minimum visible bone length and the other at a fracture gap of 60.2 The semi-automated algorithm presented in this work enables robust and accurate quantification of malalignment of fractures of the femoral shaft in 6DOF from a single, intraoperative CBCT image of the fractured limb. A surface matching approach, based on minimizing the difference between the total profile of the fracture gap-bordering edges was able to accurately determine periaxial rotation and performed with greater accuracy and precision than methods based on matching the linea aspera and the maximum point alone. This algorithm provides rapid quantification and requires minimal user interaction. Use of this algorithm and intraoperative CBCT, in combination with a navigation platform, may be a more accurate and efficient alternative to the current fluoroscopic-based navigation systems. This research was funded, in part, through the Not required. None of the authors have any conflicts of interest to report that could inappropriately bias this work. The authors would like to acknowledge the assistance of Dr. Ernest Lam and the Department of Radiology of the Faculty of Dentistry at the University of Toronto for their assistance and work with image acquisition.