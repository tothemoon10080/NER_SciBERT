A new algorithm to optimize stope design for the sublevel stoping mining method is described. The model is based on a cylindrical coordinate defined around the initial vertical raise. Geotechnical constraints on hanging wall and footwall slopes are translated as precedence relations between blocks in the cylindrical coordinate system. Two control parameters with clear engineering meaning are defined to further constrain the solution: (a) the maximum distance of a block from the raise and (b) the horizontal width required to bring the farthest block to the raise. The graph obtained is completed by the addition of a source and a sink node allowing to transform the optimization program to a problem of maximum flow over the graph. The (conditional) optimal stope corresponding to the current raise location and height is obtained. The best location and height for the raise are determined by global optimization. The performance of the algorithm is evaluated with three simple synthetic deposits and one real deposit. Comparison is made with the floating stope technique. The results show that the algorithm effectively meets the geotechnical constraints and control parameters, and produce realistic optimal stope for engineering use.Mine layout in underground mining plays a significant role in the viability of a mine. The design of excavations (or ‘stopes’, as called in underground mining methods) is one important decision controlling the economic profitability and the safety of the mining production. Generating optimal underground stopes to maximize the economic profit subject to geotechnical constraints is a difficult problem with currently no known solution. To optimize a stope, an ore reserve model must be available to serve as basic input for optimization. This model is usually defined by a set of small regular blocks whose ore grade values are obtained from geological analysis and geostatistical estimation or simulation ( Previous works on stope optimization relied mostly on strong simplifications of the initial problem. For example, the 3D problem was simplified by considering optimization along only one or two dimensions. The dynamic programming method ( Contrary to underground mines, the optimization of open pits has a well known optimal solution. Geotechnical constraints are wall angles of the open pit. They are enforced by linking blocks of a lower level to the blocks of the above level so that the linked blocks define the requested angles. Graph theory and network concepts based methods are prominent and successful techniques for optimization of such problems. The Lerchs–Grossmann algorithm (LGA) ( Although the open pit optimization cannot be directly applied to underground mining, it is very helpful to seek for analogies. In open pit, every block is moved toward the initial ground free surface. In sublevel stoping, an initial free surface is artificially created by drilling, most of the times, a cylindrical vertical raise. This suggests the idea of using a cylindrical coordinates system defined around the central line of the raise. By cleverly linking the blocks defined in the cylindrical coordinates system, it must be possible to enforce the geotechnical constraints and ensure that each block selected could flow by gravity to the opening created around the initial raise. These two ideas constitute the core of our approach. It enables to translate the sublevel stope optimization into a simple graph problem following basically the same approach as for open pit optimization, hence, allowing efficient computation. In the following sections, we describe in detail the analogy between open pit optimization and sublevel stope optimization, and we describe the proposed algorithm. Then, several case studies, both synthetic and real, are presented. We analyze the results obtained and discuss the performance and limitations of the algorithm. The profit of a block Open pit optimization uses graph theory concepts. The ore block model is represented as a weighted directed graph Despite its conceptual simplicity, the integer program is CPU intensive, because the number of ore blocks In open pit optimization: (1) all the blocks mined are brought to the surface, either to be treated at the mill or to be dispatched to the waste dump, (2) the blocks on upper levels must be mined prior to blocks on lower levels, (3) the slope angles of the open pit are ensured by the arcs linking the blocks. Thus, the precedence relationship can be expressed as in In the sublevel stope mining, the ore within a stope is accessed initially from a vertical raise. Long holes are drilled around the raise and the ore is blasted into the raise. After a sequence of blasts, the ore falls down by gravity toward the raise and the bottom of the open spaces available. Eventually, the broken ore fills the stope due to swelling. Ore is then hauled to the surface for further treatment. The removal of broken ore creates new open space in stope for further blasting. The blasting and hauling are run sequentially until all the planned stope is mined. In some cases the stope is partly backfilled between sequences of blasts. In the end, the stope is generally closed with full backfill to ensure stability. In our approach, the following geotechnical aspects of the stope geometry are considered ( The footwall slope toward the raise must be smooth and steep enough, so that blasted ore can easily flow to drawpoints. Similarly, the hanging wall must be steep enough to prevent undesired blocks from falling within the stope and therefore increase ore dilution, and possibly jeopardize the stope integrity. The minimum acceptable footwall angle and hanging wall angle are defined typically to be at least 45°–55°. In horizontal section, a stope should be wide enough for the fluency of ores. The height of the stope should be within certain acceptable limits for rock mechanics stability consideration. Finally, a stope is typically at least 6 The role played by the vertical raise, in stope level mining, is analogous to the ground surface in open pit mining. It suggests to use a cylindrical coordinates system based on the center line of the raise. Each point can be expressed as ( The grades in these irregular blocks are estimated by creating an internal grid of points (here of 3×3×3=27 points) within each cylindrical block. The points are then estimated and averaged with weights proportional to the volume associated to each internal point. This ensures to properly reproduce the support effect for the irregular blocks defined in the cylindrical system. We define the arcs in the graph needed to ensure the desired hanging and footwall slopes and the minimum width requirement. Thanks to the adopted cylindrical system, these two constraints can be split and considered separately. Consider a vertical section of the model passing by the raise center line. To mine block Consider now a horizontal plane in the cylindrical coordinates system having discretization The links in the horizontal plane, propagated from block to block, eventually reach the raise center line (where The optimization algorithm comprises two main parts. The first part, the stope optimizer, is the core of our approach. It consists, for a specified raise location and height, to optimize the stope value given the chosen design parameters ( Construct economic block model in cylindrical coordinates with current raise location and height as reference axis. Build the graph with vertical arcs for footwall and hanging wall slope constraints (see Section Add the source and sink nodes to the graph. Positive nodes are linked to the source with capacities equal to their value and negative nodes are linked to the sink with capacities equal to their absolute value. Solve the maximum flow problem using an efficient algorithm. The sum of the residual capacities on the arcs linking the source to the positive nodes is the current stope value. This stope is conditionally optimal to the raise location and height. In the second part one searches the best raise location and height using as objective function the stope value found with the stope optimizer. This is done here by global optimization on the raise location and height parameters using the pattern search method ( After the overall optimal stope is found, we convert it to the Cartesian system. For this, each point of a fine Cartesian grid (here 1 The floating stope technique ( To test the performance of the proposed algorithm, four different models, three synthetic and one real ore body, are used as input for the optimizer. The three synthetic cases are used to illustrate and help understanding the behavior of the proposed algorithm on perfectly known simple bodies. They are not aimed to represent real deposits. The shapes of synthetic orebodies are kept simple so as to allow direct visual inspection of the feasibility and optimality of the stope. In those scenarios, the geotechnical constraints are given in In the first scenario, a cross shape ore deposit is created ( The second case represents a thin vertical deposit of size 2 The third synthetic ore model is a small parallelepiped of size 20 An ore model of a metal deposit located in Canada is used as another test case (name and location of deposit undisclosed for confidentiality reasons). A part of the deposit is selected for stope design. The orebody is subvertical with size 50 The floating stope technique is applied on the same three synthetic cases and the case study. The profits obtained are listed in In case 4, the profit of the inner stope is equivalent to that of the proposed method, 509 We created a new stope optimizer for sublevel stoping methods. The optimizer is based on analogies with open pit mining to represent the underground optimization problem as an oriented graph that can be solved using efficient maximum flow algorithms. Two key ideas are at the core of the proposed approach. First, the initial raise outer surface plays the role of the ground surface in open pit mining. Second, having decided of the raise location and extent, it is possible to define a cylindrical coordinate system around the raise and then establish precedence links between the blocks required to meet the geotechnical constraints on the footwall and hanging wall slopes. Finally, optimization the raise location and height parameters is obtained by global optimization of the stope profit (seen as a function of these parameters). The method presented is the first one that can really define optimal stopes, in 3D, that fully integrate geotechnical constraints. The method is suited for deposits that can be mined by the sublevel stoping method. This mining method is considered one of the best underground mining method currently available due to its low operation cost and the high security for the mine workers. Further research is needed to adapt the approach to other mining methods. The proposed method was compared to the floating stope technique available in Datamine and Vulcan softwares. In the three synthetic cases, the profits obtained with our approach were larger than with the inner and outer envelopes obtained with the floating stope algorithm. On the real case study, our approach provided an equivalent profit to the inner envelope and more profit than the outer envelope (+53%). Note that neither of the floating stope envelopes meet the slope angle constraints, as these constraints are simply not considered in this algorithm. One appealing aspect of the proposed method is that it possesses two control parameters with a clear meaning for the mining engineer. The two control parameters are the reference distance to the raise, The main limitation of the proposed algorithm lies in the use of a vertical raise which would constitute a good choice mainly for subvertical or subhorizontal deposits. When orebody is inclined, a vertical raise would include possibly too much waste. In that case, an inclined raise is used. However, the adaptation of the cylindrical coordinate system to an inclined raise and determination of the precedence links needed to ensure geotechnical constraints need further research. A second important limitation of the approach presented is that a single raise parameters were optimized for a relatively small mineralized body. For larger orebodies, many contiguous stopes (and therefore many raises) will be required. It should be relatively simple to adapt the global optimization on a set of parameters representing simultaneously more than one raise. This is the subject of ongoing research. Variations in development costs and operational costs linked to choice of the raise location and height were ignored in our approach. These costs variations are (1) expected to be small or even negligible compared to the gain in stope profit due to the selection of the optimal raise location; (2) case specific as they depend on the location of the infrastructures in the mine. For a particular mine setup, it is possible to assess the development cost for any given raise location and height and to include this extra cost in the profit function. For the operational costs, it suffices to replace in Eq. For a cylindrical grid having 70×121×61 blocks, the stope optimizer runs in approximately 15 The extension to simulated grades instead of estimated grades is straightforward. One replaces the estimation of each point on the cylindrical block internal grid by a series of realizations. Then each realization is averaged separately within each cylindrical block (with weights proportional to the volume associated to each internal point). In open pit mining, due to non-linearity of the profit function, it was proven more profitable to optimize the expected profit of each block than the profit computed from the estimated grades ( The proposed method enables determination of the optimal stope design in 3D for relatively small subvertical deposits mined by the sublevel stoping method. The optimal stopes obtained comply to geotechnical constraints on footwall and hanging wall slopes, and on stope minimum and maximum heights. Applied on a real deposit, it gave realistic stope design. Further research is needed to extend and adapt the method to larger subvertical or subhorizontal deposits or to inclined deposits and also to other mining methods. The Chinese Scholarship Council provided a Ph.D. scholarship to the first author. Additional financing was obtained from NSERC research grant of the second author. The authors are grateful to three anonymous reviewers for their numerous constructive and helpful comments.