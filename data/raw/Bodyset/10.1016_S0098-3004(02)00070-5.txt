Truncated plurigaussian simulation is a useful method for simulating spatial categorical variables, such as facies, in a geological context. The method is an extension of the truncated Gaussian method that retains the main advantages of the latter (mainly that it produces permissible sets of indicator semi-variograms and cross-semi-variograms) but overcomes its limitations (the truncated Gaussian method only reproduces sequentially ranked categories). The method is based on the truncation of two Gaussian random functions that may, or may not, be correlated. PLURIGAU is an ANSI Fortran-77 computer program for performing conditional or unconditional truncated plurigaussian simulations of spatial categories. The number of facies, spatial relations between the facies, proportions of each facies, indicator semi-variograms and indicator cross-semi-variograms must be known or estimated from experimental data. The program calculates the four thresholds for each of the facies (two for each of the Gaussian random functions) and the covariance models for the two Gaussian random functions.
                  The simulation of the Gaussian random functions may be done using any of the methods available. Conditioning has been implemented by a simple acceptance–rejection technique embedded within sequential Gaussian simulation algorithm. A case study is provided so that the implementation of the programs can be checked and the results are discussed.The simulation of spatial categorical variables (e.g. lithofacies in geosciences) is of importance in its own right as well as providing a means of including geological constraints in the simulation of quantitative variables ( The principle of truncated Gaussian simulation (TGS) was established almost 20 years ago ( there is a wide range of algorithms available for generating realizations of a Gaussian random function, TGS guarantees that the indicator covariances and cross-covariances are consistent, i.e. they meet all the order relations and inequalities that must be preserved (cf. TGS does, however, have a serious limitation; it only produces simulations where the facies are sequentially ranked as, for example, in In Consider n facies The thresholds are calculated from the proportions, The procedure for the TGS method is: The number of facies, proportion of each facies and indicator semi-variograms and cross-semi-variograms (or covariances and cross-covariances) are calculated experimentally. The thresholds are calculated from The covariance of the standard Gaussian random function is determined from A realization of a standard Gaussian random function, with the covariance calculated in the previous step, is generated using any of the available methods (sequential, LU decomposition, spectral, etc.) The thresholds are applied to the realization in order to generate realizations of the facies through In TPS any number of Gaussian random functions may be used. However, in practice, to simplify the specification of the spatial relationships among the facies, TPS is restricted to the use of two Gaussian random functions In practice, The aspects that must be considered when applying TPS are: Number of facies. Spatial relation between the facies. Determination of thresholds for both Gaussian random functions Determination of the covariance of each Gaussian random function from the indicator covariance and cross-covariances. The case of only one facies is of no interest and two facies can be simulated by the TGS method. TPS is thus applicable for three or more facies. Even for three or more facies, TGS can be used (and is more appropriate) if the relationship among the facies is a simple ranking The experimental relation between the facies, i.e. if there is a ranking or if there is a direct contact between a given pair of facies, is one aspect that must be established experimentally from observations in boreholes, outcrops, geophysical data, geological models, etc. The final setting will be a layout of the facies in the plane defined by the two Gaussian For three facies there are two possibilities as shown in With four facies there are five possibilities as shown in The case shown in For the relationship shown in In The number of facies may be extended to five or more and every case could be considered separately although, in general, each will be an extension of the previous cases. The possibilities for five facies are shown in The thresholds are specific for each case and they depend on the layout of the facies. In all cases    The last equation is a function of  Similarly, for the rest of the cases we have      The experimental indicator covariances and cross-covariances for the different facies, In practice, there are The relation between the indicator covariance and indicator semi-variogram is given by Truncated plurigaussian simulation requires four steps, each of which is implemented by the corresponding computer program: Determination of thresholds (four for each of the facies), and correlation coefficient between Gaussians and covariance models for each Gaussian random function. This step is done within the program Transformation of the conditional facies data to Gaussian values (one value for each of the two Gaussian random functions). This step is done within the program Simulation of a realization of each Gaussian random function with the required covariance model. This may be done with any geostatistical simulation method. For convenience, the SGSIM program ( Application of the thresholds to the Gaussian realizations to obtain simulated facies. This step is done within the program PLURIGAU has nine external subroutines as shown in Number of facies. Proportion of each facies. Spatial relation between the facies, i.e. which of the cases (a)–(l) is to be simulated. Indicator semi-variogram file. File name for the output results. Correlation coefficient between the two Gaussians. Type of model for the first Gaussian random function (spherical, etc.) Type of model for the second Gaussian random function (spherical, etc.) Definition of the search grid for the ranges of each Gaussian. An index that specifies whether the Gaussian random functions are anisotropic. When anisotropy is specified, the number of points that define the anisotropy search angle. When anisotropy is specified, the number of points that define the anisotropy search ratio.  The number of facies NFAC must be 3 or 4. The equations for five facies are given in this paper but have not been included in the program. For more facies similar equations could be derived and programmed. Each proportion must verify the relation: 0< The case number has no effect if the number of facies is three. The case number may be 1, 2 or 3 if four facies are simulated. If the number of facies is 3 only case b is considered. If the number of facies is 4, case numbers 1, 2 and 3 refer to cases d), e) and f), respectively. The indicator semi-variograms and cross-semi-variograms are estimated from the experimental data. The semi-variograms for the Gaussian random functions are estimated by It should be noted that not all the estimated indicator semi-variograms and cross-semi-variograms need to be included in the indicator semi-variogram file, only those that are required for the fitting procedure. For example, noisy semi-variograms with no apparent structure need not be included. The format of the semi-variogram file is The indices IVA1 and IVA2 specify the indicator semi-variogram or cross-semi-variogram, for example, The correlation coefficient must be 0⩽ The type of semi-variogram model (IM1 and IM2) may be 1 (spherical), 2 (exponential) or 3 (Gaussian). For each covariance the nugget variance is 0 and the number of nested structures is 1. The range of each first Gaussian is searched on a grid with origin OR1, number of grid points NG1 and grid size If the first Gaussian is anisotropic then IAN1 must be set to 1; any other value indicates the Gaussian is isotropic. Similarly for the index, IAN2, for the second Gaussian. The parameters For anisotropic Gaussians, the model is defined using GSLIB conventions, i.e., a major range plus three anisotropy angles (azimuth angle The subroutines used by PLURIGAU are described below.        z: correlation coefficient between Gaussian random functions   s: value of the integral for the indicator covariance between the ith and jth facies. If the correlation coefficient, z, is 0 then a more efficient evaluation is When the correlation coefficient between the Gaussians is zero, the indicator covariance and cross-covariance can be evaluated by calling INTGAUSC or by two calls to INTGAUSB, with the latter being the more efficient, i.e. INTGAUSC uses the external subroutines INTGAUS3, INTGAUSB and INTGAUS2.  The four-dimensional integral, evaluated by INTGAUSC using 32-point Gauss quadrature, could be evaluated by 16-point Gaussian quadrature using the subroutines INTG8C INTG83 INTG8B INTG82 or by 10-point Gaussian quadrature with the subroutines INTG5C INTG53 INTG5B INTG52 which are equivalent to INTGAUSC, INTGAUS3, INTGAUSB and INTGAUS2, respectively. The main program must be linked with the appropriate set of subroutines for the precision of integration required. Higher precision will incur longer running times.  PLURIGA1 simulates Gaussian conditioning information corresponding to the facies conditioning information. It uses a simple acceptance/rejection approach embedded in the sequential Gaussian simulation process. The acceptance–rejection method is proposed for obtaining Gaussian experimental (or conditioning) values from the experimental facies values. The original experimental (or conditioning) data are categorical, i.e. facies codes, but what is needed are Gaussian values that yield the original facies codes when the Gaussian thresholds are applied to them (from the truncated plurigaussian method); have the same semi-variograms as those calculated for the Gaussian random functions (from the truncated plurigaussian method). The program starts at the first experimental point and simulates a value for the first Gaussian from a standard Gaussian probability density function (pdf). If the value is within the thresholds that define the facies at that location, it is accepted. If not, it is rejected and a new value is drawn from the standard Gaussian pdf; this process is repeated until a value that falls within the thresholds is generated. Another independent value is drawn for the second Gaussian and the appropriate acceptance–rejection procedure is applied. The program proceeds to the next experimental location but from hereon it uses all previously simulated values to calculate the conditional distribution function (simple kriging); a value is drawn from the estimated conditional pdf and submitted to the acceptance–rejection mechanism defined by the facies at that location. This is the classical sequential Gaussian simulation algorithm ( The program requires an input parameter file with the following format: The program uses eight external subroutines as shown in         The program requires a parameter file with the following format: The experimental data are shown in The experimental indicator semi-variograms and indicator cross-semi-variograms are shown in The parameter file used with PLURIGAU is shown in The output of PLURIGAU is shown in One realization for each Gaussian was obtained with SGSIM and the final conditional realization is shown in Truncated plurigaussian simulation offers the advantages of truncated Gaussian simulation without the restriction of sequentially ranked categories. A wide range of situations may be devised. PLURIGAU, PLURIGA1 and PLURIGA2, together with a Gaussian simulation program, are all that is needed for simulating facies, the realizations of which may be used in practical studies such as risk analysis and the incorporation of geological controls in the simulation of continuous variables. A case study has been provided as a means of assessing the implementation and performance of the programs. The work reported in this paper was funded by EPSRC (Engineering and Physical Sciences Research Council), Grant number GR/M72944. A spatial category (or facies) There are N facies that exhaustively define a d-dimensional space A spatial indicator random variable may be defined for each category As shown below, relation Each indicator random function        The cross-semi-variogram is always negative (apart from the value at the origin) as it is equal to the non-centred cross-covariance with the sign reversed and the cross-covariance is never negative because it is a probability. It can be shown ( A particular model that satisfies TPS lies somewhere between the intrinsic model and an arbitrary choice of the (