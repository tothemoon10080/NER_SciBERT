Process simulation is a very important tool for the design, development, analysis and optimization of technical processes in the mineral industry. The ability to simulate process behavior without the cost of test runs can prevent the loss of man-hours and production, in addition to providing a platform for the development of control tools and strategies. The usefulness of a simulator ultimately relies on how accurately the underlying mathematical model represents real behavior. In mineral processing, due to varied complexities such as strong non-linearities, variable coupling, time varying parameters, etc.; the development of accurate process models becomes an increasingly difficult task.
                  This paper describes the modeling and simulation of the main components of a concentrator plant, the grinding and flotation circuits. A hybrid dynamic model was favored to better represent the different modes of operation and non-linearities exhibited by the plant. Industrial plant data was used to calibrate the models used in the simulator. Simulation tests show that the performance of the simulator is qualitatively similar to that of a real plant, and it can be effectively used as a tool for the design and simulation of control solutions.Copper minerals are too diluted in ore (0.5–2% of Cu) to be smelted directly. Given the great amount of worthless rock, direct heating and smelting would demand too much energy and too much furnace capacity. To address this issue, ores which are destined to pyrometallurgical processing are first concentrated, resulting in a product which contains about 30% of Cu ( Extensive research has been conducted on the development of mathematical models to represent the processes involved in a concentrator plant, in order to satisfy different objectives such as: plant design and optimization, design of control systems and operator training. Grinding circuits, which are composed of several unit operation such as Semi-Autogenous Grinding (SAG) mills, ball mills, vibratory screens, pebble crushers, sumps, centrifugal pumps and hydrocyclones; have been extensively studied and numerous models have been developed, ranging from static to dynamic models, and phenomenological to empirical models ( Similarly, several models have been developed to represent flotation cells. Dynamic models based on hydraulic principles used to evaluate control strategies for pulp levels stand out ( An integration of the grinding and flotation processes, and a development of constrained predictive control strategies for this integrated plant is presented in In this paper, we propose a methodology to represent, by means of hybrid models, a concentrator plant composed of a grinding circuit followed by a rougher flotation line. Hybrid models incorporate both continuous and discrete variables (meaning that it can only take values from an enumerable set) into the mathematical relations that describe the dynamics of the systems considered. For the rougher flotation circuit, a hybrid model is developed to closely represent the different operating modes exhibited by the cells, using discrete variables to indicate the mode that is currently active. For the grinding circuit, on the other hand, each unit operation is represented by non-hybrid mathematical models, which are interrelated through their input and output streams. These interrelations are represented by discrete variables, which allows the model to increase or decrease the number of processing lines, simulate the blockage of pulp lines, switch between open circuit and closed circuit operation, and so on. An integrated grinding-flotation simulator is essential for an accurate prediction of the copper recovery in response to changes in plant operation, as show in The organization of this article is as follows. Section The model of a system is often associated with differential equations (for continuous-time systems) or difference equations (for discrete-time systems), typically derived from the physical laws governing the dynamics of the systems under study or from empirical observations. Additionally, in many applications the systems under consideration include parts described by logical rules, which allow these systems to transition between different operating modes. The interaction between continuous laws and equations, and logic rules motivates the development of a framework for modeling and controlling these type of systems ( A common approach for representing such systems is by using piecewise functions: The methodology used in this paper combines non-linear dynamic equations and binary variables to represent the different operating modes of the grinding and rougher flotation circuit. This methodology considers different dynamics for each condition and is suitable to represent non-linear systems, which are very common in mining processes. As previously stated, the plant studied in this article is constituted by a grinding circuit and a rougher flotation circuit. Both circuits are interconnected through the output stream of the grinding circuit, which serves as the input of the rougher flotation circuit. The objective of the simulator developed from the mathematical models presented is to be used as a tool for designing and testing different control strategies. As such, the mathematical models used focus on the transient behavior as well as the steady-state behavior. Multiple models are used in both the grinding circuit and the rougher flotation circuit, with the objective of providing a qualitatively close representation of a real concentrator plant. For simplification, the delays introduced by conveyors belts and pipes are not included in the current version of the simulator, although they will be considered in future work for the development of control strategies.  Various mathematical models are used to represent the different unit operations included in the grinding plant. The following equations, used for the SAG mill, are derived from the models developed in Power consumption in the SAG mill is modeled with the following equation: To determine the final product of the mill, the following equation is used: For the water process in the SAG mill, a scalar dynamic equation is used to represent the evolution of the water hold-up: The vibratory screen is modeled empirically as a static efficiency curve fitted to experimental data, as derived in The pebble crusher model used in this paper is presented in The sump model is based on a volumetric balance, considering perfect mixture of its contents. Two dynamic equations are used to represent the variation of the total volume and the variation of the mass of pulp inside the sump over time: The centrifugal pump static model, as presented in For the hydrocyclone battery, the equations and constant values used are developed in The second rejection process is modeled as a rejection curve, similar to the vibratory screen: Finally, the ball mill model is based on mass balance, similar to the one used for the SAG mill, as described in As the ball mill doesn’t have a discharge grate, the discharge rate of the mill is independent of particle size: The water processes in the ball mill follows the same model as the SAG mill: The stockpile feeding the SAG mill is modeled as a hybrid system where the mineral feed is a combination of three different particle size distributions: Additionally, a continuous variable is used to represent the hardness of the feed ore. This variable is can take random values between 0 and 1 and modifies the breakage rates of the mineral fed to the mill. A value close to 1 represents a harder mineral, while a value close to 0 represents a softer mineral. A second binary variable is introduced to represent the operating state of each one of the secondary grinding lines. By clearing this variable, a complete secondary grinding line is taken out of operation. This permits the simulation of pulp line blockages, scheduled maintenance and changes in the layout of the plant. From the perspective of control system design, manipulated variables for the grinding plant are the mineral feed tonnage, water feed, SAG mill speed, water addition to the sump and centrifugal pump speed. Mineral feed particle size and hardness are considered disturbances, while mill power draw, mill hold-up, sump level, hydrocyclone pressure and product particle size are considered controlled variables. Additional discrete variables can be manipulated when using a hybrid model predictive control framework, such as the number of active hydrocyclones per battery in the current model and the number of operating lines of secondary grinding.  The mathematical equations used to represent the rougher flotation circuit are derived in No overflow of concentrate. Normal operation with overflow of concentrate. Overflowing slurry (no froth). Two auxiliary logical variables ( Mass flows are represented in the rougher flotation circuit as particle size distributions composed of 4 intervals, from 0.025 The tail grade and concentrate grade for cell The hybrid dynamic model is based on the following assumptions: Constant air flow into the cell. Each phase of the cell is perfectly mixed. There is transfer between both phases, depending on the collection rate of pulp phase and the drainage rate of froth phase. The mineral recovered is chalcopyrite (CuFeS Each flotation cell has a horizontal cross section of constant area. Moreover, the pulp level inside the cell is derived from hydraulic models ( From the perspective of control system design, manipulated variables are the output controlled valves of each cell, while feed flow and feed grade are considered disturbances. Controlled variables are the pulp levels of each cell and the final tail grade of the rougher flotation line. For the grinding plant, each subsystem was calibrated independently using data from various sources. Parameters for the SAG mill, ball mill and hydrocyclone battery were calibrated using actual plant data, as shown in To perform the calibration, the plant is assumed to be in steady-state conditions. Using the data described previously and the mathematical equations that define the dynamic system, parameter identification is performed through mean square error minimization. The concentrator plant simulator is not intended to represent a specific plant, given that calibration data was collected from different sources. Additionally, this presents the difficulty of correctly adjusting each calibrated model to obtain a proper performance from the simulator when both the grinding circuit and the rougher flotation line operate simultaneously. As such, the simulator is designed to exhibit a behavior that is qualitatively close to reality. Such an open structure allows the design and test of different applications, among which stand out the development and evaluation of predictive models, testing of decision support systems and testing of control strategies. The simulator was designed and implemented in MATLAB/Simulink. Each process unit was developed as a single block, and different units are connected through streams of mineral and water. These streams are implemented as vectors, where the first  Similarly, Each block, representing a single processing units, contains the mathematical equations needed to calculate all the variables of interest in the process. Each block has its own inputs, outputs, state variables and disturbances; which are computed independently from each other. In this section the behavior of the models developed previously is tested and validated through simulations. The tests consist in introducing disturbances in the inputs to the plant (feed size distribution, ore hardness) as well as periodically changing the values of the manipulated variables (mineral feed, water addition, SAG mill speed, pump speed and the position of the input valves of the flotation cells) and observing the behavior of the outputs (SAG mill hold-up and power draw, sump level, product particle size of the grinding circuit, pulp level in flotation cells and copper recovery). The plant is expected to perform qualitatively similar to a real concentrator plant.    In  To better visualize the effect that disturbances in the grinding circuit have over the flotation process,  In this paper the development of a dynamic hybrid model for a concentrator plant was presented. The plant, which is composed of a grinding circuit and a rougher flotation circuit, was modeled through a combination of static, dynamic, phenomenological, empirical and hybrid models. Subsequent simulations of the plant show a high degree of representation of the studied processes. The development of an integrated simulator for a grinding-flotation plant allows the design and test of different applications, among which stand out the development and evaluation of predictive models, testing of decision support systems and testing of control strategies. Future work will focus on the improvement of the simulation models, such as modeling the effect of the air flow in the flotation cell. Additionally, future work will be made towards the design, development and implementation of Hybrid Model Predictive Control (HMPC) strategies. These schemes take advantage of the hybrid models presented in this paper, enabling the representation of systems incorporating logical variables, rules and continuous dynamics. The controllers designed using this framework will be tested and compared against conventional MPC strategies to evaluate its performance. This study was funded by the The mathematical models used to represent to concentrator plant presented in this study are detailed in the following section. The models related to the grinding plant are adapted from The particle sizes used for the grinding and flotation circuits are the following: The SAG mill is represented by a mass balance model which takes into account the effects of grinding and classification. Mineral flows are represented through vectors of The lower-triangular matrix The product of the mineral hold-up a the grinding rates are proportional to the power draw of the mill: To include the effect of the mineral hardness, the effective grinding rates are calculated as follows: The power draw of the SAG mill, as derived in To determine the final product of the mill, the output Additionally, the following relation is determined empirically: Finally, the final product particle size after classification is determined as follows: For the water process, a scalar dynamic equation is used to represent the evolution of the water hold-up:  The vibratory screen model is based on a static efficiency equation, where the oversized and undersized mineral flows are represented as follows: The parameters For the water process, it is assumed that only 10% of the feed water flow is rejected along with the oversized material.  For the crusher model, a static mass balance equation is used, which takes into account the processes of breakage and classification. The equations and constant values used in this model are developed in The static mass balance is characterized as: The classification rates The auxiliary variables The elements of the The function For the water process, it is assumed that the feed water flow is equal to the product water flow.  The water sump is represented trough a volumetric balance and a mass balance: Eqs. The percent solids of the pulp is determined with: The mineral and water mass flows in the product are determined with the following equations, respectively: Finally, the mineral hold-up of the sump is modeled as:  In the centrifugal pump, the volumetric pulp flow is proportional to the velocity of the pump and to the pressure difference between input and output: The input pressure is equal to the pressure exerted by the pulp in the sump: The output pressure is the sum of the pressure exerted and the feed of the hydrocyclone battery, the pressure exerted by the column of pulp in the pipes that connect the pump and the hydrocyclone battery, the pressure drop due to friction and the pressure drop due to singularities. Friction drops are proportional to the length of the pipe and the square of the pulp velocity, and inversely proportional to the diameter of the pipe. On the other hand, singularities drops are proportional to the square of the pulp velocity. The velocity of the pulp flow can be determined with: Finally, the output pressure can be expressed as: To simplify the model, the quadratic term of the volumetric feed flow is disregarded by making the parameter  The hydrocyclone battery is represented with a mass balance equations involving two distinct processes. The first process represents the pulp rejected from the battery due to the amount of water in the pulp, while the second process represents the classification performed by the hydrocyclone. The equations and constant values used in this model are developed in The first processed os characterized by: The output water flow is related to the feed water flow and the percent solids of the pulp by the following empirical equation: The process of classification is characterized by the following equation: The elements The parameter The pressure of the pulp at the feed of the hydrocyclone battery is determined with the following empirical equation: The final product mineral flow and rejected mineral flow are determined by:  The ball mill is characterized by a mass balance model similar to the one used in the SAG mill model: The lower-triangular matrix There is no classification process in the ball mill, so it is assumed that the particle size distribution of the product mineral flow is the same as the mineral hold-up: The water processes in the ball mill follows the same model as the SAG mill:  The flotation cell model considers three operating modes determined by the level of pulp and froth. The operating modes identified are: No overflow of concentrate. Normal operation with overflow of concentrate. Presence of pulp in overflow of concentrate. To represent the operating modes, two auxiliary binary variables were defined: Mass balance equations were used to model the mass of the pulp phase and the froth phase inside the cell, incorporating the feed flow, concentrate flow, and tail flow: The total volume for each cell is determined as follows: To determine the level of the pulp phase, a volumetric balance is performed (considering that the froth level is negligible compared to the pulp level). The tail volumetric flow was derived from Torricelli’s law, while the concentrate volumetric flow was represented with an empirical function of pulp level, froth level, and cell height: Mass flows are determined by combining mineral masses and volumetric flows: The tail grade and concentrate grade for cell Finally, the final recovery of the rougher stage is calculated as follows: 