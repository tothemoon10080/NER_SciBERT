The aim of this study is two-fold: first, to analyze the effect of stochastic uncertainty in the design of flotation circuits and second, to analyze different strategies for the solution of a two-stage stochastic problem applied to a copper flotation circuit. The paper begins by introducing a stochastic optimization problem whose aim is to find the best configuration of superstructure, equipment design and operational conditions, such as residence time and stream flows. Variability is considered in the copper price and ore grade. This variability is represented by scenarios with their respective probability of occurrence. The resulting optimization problem is a two-stage stochastic mixed integer nonlinear program (TS-MINLP), which can be extremely challenging to solve. For this reason, several solvers for this problem are compared and two stochastic programming methodologies are applied. The combination of these techniques allows the production of high quality solutions and an analysis of their sensitivity to epistemic uncertainty. The results show that the stochastic problem gives better designs because it allows operational parameters to adapt to the uncertainty of the parameters. The results also show that the flotation circuit structure can vary with the feed grade and copper price. The sensitivity analysis shows small to moderate variability with epistemically uncertain parameters.Flotation is a physicochemical process that allows the separation of minerals, such as copper sulfide minerals and molybdenum, from the remaining minerals that form most of the parent rock substrate, including contaminants, such as arsenic minerals ( Mineral processing presents several challenges, such as the use of energy and water with minerals that are increasingly complex in composition. In addition, environmental regulations have led smelters ( The methods employed in flotation circuit design can be generally classified into heuristic, rigorous, or hybrid types. Heuristic designs are based on the application of rules that permit feasible solutions to be attained and where the experience of the designer is employed ( The quality of the model of the flotation stage for the purpose of flotation circuit design using optimization has been controversial. While some authors indicate that using a robust flotation model is the first step towards finding the optimal circuit design ( Large numbers of variables are handled in the design of flotation circuits, some of which may involve uncertainty. These uncertainties usually involve external factors, such as product price, economic factors, environmental factors, or internal plant conditions, including feed grade and kinetic constants, which might lead to an inefficient process design ( In general uncertainty can be classified as epistemic or stochastic. Epistemic uncertainty (or subjective, reducible) arises from the lack of knowledge about the appropriate value to use for a quantity that is assumed to have a fixed value in the context of a particular analysis. Stochastic uncertainty (or irreducible) derives from an inherent randomness in the behavior of the system under study. In the design of a flotation circuit the metal price and the feed grade present stochastic uncertainties. On the other hand, kinetic constants have epistemic uncertainty because these values change with equipment size, pulp chemistry, particle size, and particle composition among several other variables. Therefore, the exact value for the kinetic constants is not known before the circuit is designed. A few studies have been conducted in which stochastic or epistemic uncertainty is included in the design and/or simulation of the processes. Some of these studies have focused on the representation of parameter uncertainty, either through specific probability functions, such as the Gaussian distribution ( The present study aims to analyze the effect of stochastic uncertainty in the process design of flotation circuits and to show the feasibility of conducting this analysis through a stochastic optimization problem. The rest of this study is organized as follows. The flotation circuit is represented through a superstructure of stages that represents all alternative flotation-circuit configurations. The superstructure is based on a generic representation of a stage, which is used to describe all stages that are to be included in the design. In the superstructure, discrete variables are used to represent the different alternatives for the circuit configuration, and continuous variables are used to represent the design specifications and operational conditions. The generic representation of a stage is complemented with an origin–destination matrix where the allowed concentrate and tail streams are identified ( While expert analysis can be used to significantly reduce the number of alternatives (e.g. see the discussion on origin–destination matrices in Because of the presence of stochastic uncertainty, a class of optimization problems known as two-stage stochastic (non-convex) mixed integer nonlinear programs (TS-MINLP) is used. A TS-MINLP is divided into two stages, which, in our context, can be identified with the design and operational stages. The first stage (i.e. the design stage) includes all decisions that need to be made before the uncertainty is resolved (e.g. physical characteristics of the circuit stages). The second stage (i.e. the operational stage) includes all decisions that can be made after the uncertainty is resolved (e.g. after feed grades are known). A common simplification in TS-MINLP is to assume that all possible ways in which uncertainty can be resolved can be summarized in a finite number of scenarios with given realization probabilities. Using this simplification, a generic TS-MINLP can be written as ( The objective function in Following is a description of the constraints, objective function, specific problems and instances used throughout the paper. Note that indices are represented as lowercase letters (e.g. s, f, e), sets are represented as uppercase bold letters (e.g. The first set of constraints specifies feed flows of specie The next set of constraints enforces mass balance in the flotation stage. To describe these constraints a recovery model is needed. There are several models for the kinetic of flotation ( The kinetic parameters, The next set of constraints enforce mass balance in flotation stage, mixers and splitters, which corresponds to The next set of constraints enforce the requirement that the residence times and flows be compatible with the cell volumes, which corresponds to The next set of constraints enforces the splitter selection, which can be described through the disjunctions The final set of constraints adds penalties for the presence of arsenic in the concentrate. In this study, three possible situations are considered: (a) if the As concentration is below 0.2%, then penalties and additional costs are not considered; (b) if the arsenic concentration is between 0.2 and 0.5%, then it is considered a penalty payment; and (c) if the arsenic concentration exceeds 0.5%, then an additional cost of treatment of the concentrate by roasting to partially remove arsenic at a level below 0.2% is considered. This can be described through the disjunctions Disjunctions Besides the possible arsenic penalty The amortized fixed equipment cost The revenue of selling concentrate is calculated using the net-smelter-return formula ( For the deterministic problem, there is only a single scenario; hence, This problem is denoted the For the stochastic problems, it is assumed that there is more than one scenario ( This problem is denoted as the The computational experiments in this paper consider a flotation plant that has four mineralogical species: fully liberated chalcopyrite (CuFeS The stochastic parameters are the feed-copper grade and the copper price. Because of the variability of the processed ore, three levels of feed-copper grade are considered (low, medium, and high), and because of the variability of the world market, the price of copper on the London Metal Exchange is highly uncertain, which is why three levels of metal price are considered (low, medium, and high). The combination of these parameters is represented in 9 stochastic scenarios, as shown in For the superstructure, a flotation plant with five flotation stages was considered: rougher (R), scavenger (S), cleaner–scavenger (CS), cleaner (C), and re-cleaner stages (CC). The numbers of cells by bank are fixed according to the notes made by Finding optimal solutions for the target TS-MINLP can be extremely challenging even with state of the art solvers. However, as shown in this section, using simple stochastic programming techniques it is possible to obtain high-quality (and possible near-optimal) solutions. The section is divided into two parts. The first considers the selection of an appropriate MINLP solver and the second describes two simple stochastic programming techniques. All problems described in Because the complete problem is too challenging for some of the solvers, this section considers a subset of the superstructure that involves three flotation stages: rougher, scavenger, and cleaner. In addition, the numbers of cells by bank are fixed according to the notes made by The results for the optimization problem (total income, recovery and grade) and execution time are shown in Even with an appropriate solver selection, the stochastic problem is still too hard to solve directly. For this reason, two methodologies are analyzed to facilitate the convergence of the stochastic optimization problem. The first methodology begins by independently solving each scenario. As described in the previous section this can be done extremely fast using Bonmin. However, this solution has the first stage design variables (i.e. volumes) varying with the scenarios, which is not feasible. For this reason, in the second step of the methodology, the volume is fixed to the maximum value of all of the volumes found in each of the scenarios. This ensures that there is enough capacity of each flotation stage for all scenario-specific operational selections in the first step. The methodology ends by resolving the problem for each scenario with the volumes fixed to the common volumes determined in the previous step. This is denoted as Solution Methodology A. The second methodology again begins by independently solving each scenario. The binary variables of stream directions of the superstructure in the stochastic problem are then fixed to the values obtained in the previous step. In this manner, the majority of the binary variables in the stochastic problem become parameters making it much easier to solve. The final step of this methodology is to simply solve the stochastic problem with fixed binary variables. This is denoted as Solution Methodology B. The results of the two strategies for the full 5-stage instance are presented in This section compares solutions for the stochastic and deterministic average problems. The solution for the stochastic problem is that obtained by solution methodology A and the solution of the deterministic average problem was obtained by solving the appropriate MINLP with BONMIN. This section also presents a sensitivity analysis for the epistemically uncertain parameters. This section compares the design and operational variables plus the profits obtained by the stochastic and deterministic average problems. As noted in  In contrast, the stochastic problem can adjust its operational variables to the uncertainty of the design parameters. These adjustments increase the final profits by 3900 MMUS$/y. In this case, the volume increases in the CS, C, and CC stages, corresponding to the optimal results for the most favorable scenario of grade and price. Once the first level variables are defined, the second level variables to be optimized are the stream directions and operating time of each stage. The results are shown in The optimal configuration changes as the values of copper grade and price change. For example, for scenarios of low and medium levels of feed grade combined with favorable levels of price, the configuration changes, sending the S concentrate to the C feed ( The stochastic problem sacrifices some scenarios to obtain higher profits. Thus, scenarios 1, 4 and 5 give worse results than the deterministic average problem. However, the greatest profit obtained in other scenarios justifies this choice. These differences between the profits for each scenario are shown in In this work the stage recoveries were calculated using the kinetic model of To obtain insight of the effect of the stage recovery uncertainties three numerical experiments were performed: First, the cell volume was assumed constant and the kinetic parameter A stochastic optimization problem for the design of flotation circuits under stochastic uncertainty has been presented. Uncertainty is represented by scenarios that include changes in the feed grade and in the metal price. The problem allows the operating conditions (residence time and mass flows of each stream) and flow structure (tail and concentrate) to be changed for each scenario while the fixed design (size of cells in flotation stages) for all scenarios is maintained. The problem can be modified to include other uncertainties and other adaptive variables. While the problem is extremely flexible, it can be extremely hard to solve with standard software. For this reason several solution approaches were explored. The first approach was an appropriate selection of a MINLP solver. The optimization problem developed requires the solution by a specialized solver to guarantee a global optimal solution is found. However, standard global optimization solvers such as BARON and LINDOGLOBAL cannot currently handle the instance sizes considered in this paper. This leads to the computational evaluation of solvers that are only guaranteed to provide a local optimal solution. These experiments showed that utilizing the solver BONMIN provided an excellent compromise between solution time and quality. Unfortunately, solver selection alone was not enough to handle the target instances. For this reason two simple stochastic programming methodologies were used to solve the optimization problem. These methodologies delivered high quality solutions in reasonable times, which allowed an analysis of the advantages of the stochastic optimization problem and a sensitivity analysis of the parameters that have some epistemic uncertainty. The analysis showed that the stochastic problem gives better results than the average deterministic problem by allowing the optimal to adapt to the feed composition and the price of the metal. The sensitivity analysis to the epistemic uncertainty in the kinetic parameters showed small to moderate variability. Finally, it can be concluded that the use of stochastic optimization can be a beneficial tool in the design of a metallurgical process, specifically the copper flotation process. The optimal configuration is capable of adapting to uncertainty, leading to an increase of the profits of the company. Further studies are still needed to incorporate the epistemic uncertainty in solving flotation design problems. In particular, the specific designs from  scenarios. The set of all scenarios is flotation stages. The set of all flotation stages is species. The set of all species is streams. The set of all streams is the feed, concentrate output, and tail output streams of stage mixers and splitters. The set of all mixers is the first and second possible outputs for splitter the input and output streams of the splitter or mixer  flow of specie operating retention time (one cell) in flotation stage cell volume in flotation stage  binary variable, for arsenic level decision as in scenario cost associated to arsenic under scenario operation cost under scenario income under scenario amortised fixed equipment cost  flotation rate of specie maximum recovery of specie  constants for arsenic penalization pulp aeration factor and corrected density for flotation stage economic parameter for fixed costs arsenic grade of specie copper grade of specie processing and economic parameters for income and operational costs total mass of input to the system amortization constant for fixed cost number of cells in flotation stage  copper price under scenario feed grade corresponding to specie Financial support from