A prototype prediction based intelligent diagnostic system that is capable of integrating qualitative and quantitative process models and operational experience in the form of HAZOP result tables is proposed in this paper.
                  The diagnostic system utilizes Gensym’s real time G2 expert system software. Its diagnostic “cause-effect” rules and possible actions (suggestions) are extracted from the results of standard HAZOP analysis. The knowledge base of the system is organized in a hierarchical way following the hierarchy levels of a multi-scale model of the process system. This supports focusing used by fault detection and loss prevention and thus decomposes the otherwise computationally hard problem. Prediction by simplified dynamic models are used to reduce ambiguity in case of multiple possible causes and/or multiple possible mitigating actions.
                  The system is illustrated on the example of a commercial fertilizer granulator circuit using a simulation test bed.Fault detection and diagnosis in large-scale systems is a challenging area from a theoretical point of view as well as being of great practical importance. This procedure is used for responding to abnormal conditions in a process by detecting abnormal events, diagnosing their causes and bringing the process back to its normal (safe) mode of operation. Due to the complexity and application area dependence of the fault detection and diagnosis procedures, each area has developed its own methodology with relative little overlap. However, there are attempts to foster the synergy of the methods, for example, in the area of manufacturing Process system are known to be complex with high hazard potential, therefore a special attention is paid to fault detection, diagnosis, risk assessment of these plants. These activities for process plants are part of abnormal event management (AEM) The heuristic information can be collected with systematic identification and analysis of process hazards, assessment and mitigation of potential damages using so-called process hazard analysis (PHA). There are several methods used in PHA studies such as failure modes and effects analysis (FMEA), fault tree analysis (FTA) and hazard and operability analysis (HAZOP). For PHAs, the most widely used procedure in the process industries is HAZOP analysis Considering the above, the possibilities for using only conventional model-based fault detection and diagnosis approaches based on either dynamic state-space In addition, process plants are often regarded as large scale systems, where both analytical and symbolical/qualitative techniques may fail to be practically feasible. In such cases, a multi-scale approach Given the above characteristics the aim is to develop a model-based fault detection, diagnosis and loss prevention method for large-scale process systems that is able to handle uncertain and/or heuristic knowledge together with partial dynamical information, automatically focus on the faulty part of the system, handle multiple fault hypotheses and improve the diagnosis, give advice for recovery strategies. The paper starts with a section on a multi-scale view of fault detection and diagnosis. The fundamental principles of prediction-based diagnosis, qualitative prediction and loss prevention are introduced together with the notion of HAZOP analysis and HAZOP results tables. These techniques have to be embedded in the multi-scale modelling paradigm in the case of large and/or complex systems. The next section deals with the components of a multi-scale diagnostic system implemented in a real-time expert system, where the main elements of the knowledge base are described using diagnostic rules arranged in hierarchy levels. Thereafter a proposed diagnostic procedure with fault detection, diagnosis and loss prevention steps is discussed. Finally, the proposed method and a prototype diagnostic system based on the proposed approach is illustrated with a commercial fertilizer granulation circuit example. Fault detection can demand a dynamic model of a plant to determine the time of occurrence. In addition, fault diagnosis needs the model of the particular faulty modes to allow isolation to be performed. One then needs to combine these features with the multi-scale modelling paradigm in the case of large-scale process systems in order to predict the consequences of the fault and to propose preventive actions to minimize its harmful effects. In the case of large and/or complex systems, the use of a multi-scale modelling A multi-scale model is then an ordered collection of partial models or sub-models that are connected by a so-called Note that a hierarchically structured composite model may arise from other sources than multi-scale modelling. These models are used by our prediction-based diagnosis approach the same way as those originate from multi-scale modelling. When multi-scale process models are derived for diagnosis, the model hierarchy is defined along the length and detail scales only, where the granularity level along the length scale varies naturally when one changes the level of detail that one considers in the process Given the time-scale behaviour of the system and the time-level of interest, one can develop If the fault detection and diagnosis is based on a comparison between real plant data and the predicted values generated by a dynamic model then we speak about prediction-based diagnosis. The ingredients of a prediction-based diagnostic system for large process plants are briefly introduced below. A relation defined on measurable or computed quantities is called a symptom when it is possible to connect this relation to a root cause of any malfunction or fault. Symptoms are identified deviations from operational intention. Most often the relations are inequalities. The values of a symptom are Boolean ( In the case of dynamic systems the majority of their measurable quantities are variables that change with time. Thus the value of a symptom is also a time-varying quantity. A simple example is the symptom Symptoms have a measurable variable associated with them that connects them to the process model. Therefore if the model is large and complex the symptoms can be arranged along the process model hierarchy driven by the variables on which the symptom is defined. Thus any rule-base associated with symptoms is also naturally modularized and driven by the structure of the hierarchical process model. In the case of large scale complex process plants one often needs to cope with uncertain or heuristic information when performing the prediction. Therefore, one should be able to treat uncertain predictions and those with growing uncertainty in time, similarly to the case of e.g., medical diagnosis In addition, the computation of predictions with heuristic, logical and/or qualitative models is a computationally hard problem, that is, the computational effort needed for the prediction may grow exponentially with the size of the problem. Therefore, is necessary to decompose the system and then to execute only the relevant part of the dynamic model by automatic focusing to achieve a practically feasible solution for large scale systems. In the case of multi-scale models, however, the time-scale analysis of the model and the scale-reduced simplified models (see Subsection Sometimes, it is not enough to detect and isolate the faulty mode of a system but advice needs to be given to the operating personnel on how to avoid the unwanted consequences of the fault by suitably chosen preventive actions. This leads to the development of operator guidance systems (OGS). In such cases an additional “what if” type conditional prediction is also needed to investigate the effect of a possible preventive action. The hazard and operability study (HAZOP), formalized by Imperial Chemical Industries (ICI) at the end of the 1960s, is the most widely used process industry methodology for hazard identification. HAZOP The results of the HAZOP analysis are collected in a HAZOP result table. A HAZOP analysis table (the structure of which is shown in The column In addition to identifying the hazards in a process plant, the expert team also identifies operability problems which prevent efficient operation of the plant. It is apparent that the input needed for prediction-based diagnosis can be extracted from the HAZOP result tables in the following way:  The relation of the symptom to the root cause can be determined from the column Preventive or corrective actions can be chosen from the last column. It can be seen from the example HAZOP tables in Therefore, it is a reasonable strategy to refine the diagnosis, or equivalently, to reduce the ambiguity on the HAZOP table applying model-based prediction with the actual state of the plant and compare the result of the prediction, a time-evolution of the measured signals, with the observed ones. If only a simplified model is available, as in most cases, then only a qualitative comparison is meaningful. If one wants to develop a qualitative multi-scale, model-based diagnostic system, a real-time expert system is the best option to choose. This supports hierarchical object-oriented model development, reasoning and has programmable automatic focusing features together with data acquisition and real-time capabilities. The knowledge elements that are needed to realize a multi-scale model-based diagnostic system are as follows: Symptoms. Root causes and preventive actions. Dynamic model segments capable of performing qualitative prediction. The relationships between the above knowledge elements are described by The elements of the knowledge base are organized in a hierarchical way following the levels of a multi-scale model of the process system as The symptoms, root causes and preventive actions together with their logical relationships are algorithmically generated from HAZOP result tables of the system to be diagnosed. This part of the KB represents the heuristic operation experience provided by system experts. The easiest and most straightforward way of representing the information contained a HAZOP table in rule format is to break the table into sub-tables and associate them with a (guide word, deviation) pair that forms a symptom. A sub-table is represented as a list of triplets An example of this representation method is the rule that is generated from the first row of the HAZOP table in  ( ( ( (  ); These knowledge elements stored in the KB describe the dynamic behaviour of the system in a given faulty mode associated to the root causes. They can be algorithmically generated from the detailed simulation model of the plant by systematic model reduction (see Subsection There can be cases, however, when a full-scale dynamic simulator of the plant to be diagnosed is available. Even in this rare case, however, it is not worthwhile or not possible to use the full-scale simulator for prediction purposes in the faulty modes. One of the reasons that the simulator is usually not designed to cover serious faulty modes, that is, the considered faults (e.g., a leak in a pipe) are simply not described. Furthermore, the systems states caused by a fault are generally outside the validity domain of the model. In addition, one is usually not willing to pay the heavy computational load associated with the operation of a full-scale dynamic simulator in every diagnostic time step, i.e., on-line. Therefore, one usually focuses on the model component in the model hierarchy the fault(s) is associated with and uses only that component (a sub-model) with the dynamic simulator. This is the approach we have taken in our diagnosis system and in the case study (see Section In the diagnostic expert system the model-based fault detection, diagnosis and loss prevention steps are organized in a cyclic process consisting of the following main steps:  Using the measured signals from the system and the relationships among them, the possible symptoms are determined with pattern matching.  Focusing is applied to find the relevant hierarchy level and/or part of the model (the dynamic model augmented with structured rules) connected to the detected symptoms by using the model and rule hierarchy. Thereafter, the possible causes are derived by model-based backward reasoning. Multiple symptoms connected to a common cause or multiple causes connected to common symptoms are also taken into account. Beyond them possible preventive actions for the potential causes are identified, too. All cause-preventive action pairs that can be identified in relation with the observed symptoms are collected in a list of possible (cause, preventive action) pairs (  Comparing the measured data with the predicted values of the variables generated in the previous diagnostic time step, the spurious (cause-preventive action) pairs can be removed from the list of the possible pairs.  Multiple prediction via what-if type reasoning is performed for each applicable cause-preventive action pair and a preventive action is suggested which drives the system back to its normal operation mode. go to step 1. The above cyclic process is executed once in each diagnostic time step. Measurements are performed in a diagnostic expert system by using standard interfaces. The measured quantities and their values present in the symptom relationships are calculated. Symptoms range from simple context sensitive limit checking to checking the presence or absence of specialized mechanisms to ensure the proper dynamic response of the system. An example of a simple symptom detection relation is A composite symptom detection relation is, for example the relation When symptoms are detected, then the possible causes and required actions are identified by rule chaining using the diagnostic and preventive action rules from the knowledge base. Then we need to focus on that part of the system where the possible causes occurred. The focusing is directed by the identified symptoms that are connected to the relevant level and partial model related to the fault. Sometimes the symptoms do not unambiguously define the possible causes, so the required actions are also indefinite. In the case when either multiple symptoms occur or multiple possible causes are found, a Because of the ambiguity of the identified possible causes, the diagnostic system uses each of the identified possible preventive actions from the hypothesis list to predict their effects, before any particular action is chosen. The identified possible preventive actions are offered as advice to the operator in the form of an ordered list, where we use the severity factor associated with the symptoms and their consequences together with the feasibility of the actions, such as the need for further manual checking or automatic execution to order the possibilities. Further research is needed to construct suitable and safe decision procedures to choose automatically from the list of possible preventive actions. The proposed method and the prototype system are demonstrated on a commercial fertilizer granulation circuit example A typical granulator circuit contains at the minimum, a granulator drum, a dryer, product screens and a crusher that are arranged in a recycle loop (see The main element of the granulator circuit is the granulator drum where fine feed and/or recycle granules are contacted with a binder or reaction slurry. The binder can be sprayed at various points along the axial direction of the drum, thus controlling moisture content in the drum. Growth occurs depending on a number of operational and property factors which include liquid phase content, collision frequency and viscosity of binder. Granules leave the granulator drum and enter the dryer. After drying, the solid particles are screened in order to separate the product in a pre-determined size range. Oversize granules are crushed and recycled together with undersize granules that come directly from the screens. The following operating units are modelled in detail following the models in  A detailed model of the granulator drum is adopted from Because of its complexity, a multi-scale model of the granulator drum itself is used. The top level considers the drum as a perfectly mixed vessel, that is broken down to three  A well mixed dryer is assumed where a separation function is used to assign which fraction of fine solid material is carried out in the exiting air stream. The separation function is defined in a vector form the size of which corresponds to the number of size ranges used. In these simulations this is typically 20 size ranges. In this model the equation that is applied to compute the residence time only takes into account the length of the dryer, its diameter, the dryer angle and the rotational speed.  For the crusher unit a fundamental model describing the two distinct events in the comminution process is required. This includes the probability of breakage of particles and the resulting size distribution of the product to the size ranges. Eq.  The screening unit is composed of two sets of screens: the oversize and product screens. The feed to the product screen is taken as the undersize outlet of the oversize screen. A screen model unit uses a selection function to assign which fraction of the size range goes to the oversize and undersize outlet streams. Besides the model blocks associated with the operating units, The applied dynamic model above is an inherently multi-scale model with the following levels along the detail (or length) scale circuit level, equipment (or operating unit) level, section level (only for the granulator drum), granule bed level (only for the granulator drum).  The structure of the diagnostic system can be seen in The measured input data for the diagnosis are provided from the granulation circuit or a detailed model of the granulator circuit A set of scale-reduced simplified models derived from the full-scale simulator is used for prediction in such a way that only the detailed model of the faulty model component such as the granulator drum is used and the rest of the model is substituted by steady-state values based on the measurements. This system part is called “test plant”. To test the effectiveness of the knowledge base and the diagnostic expert system, disturbances in model input parameters (e.g., binder flowrates, feed flowrates) were used. In this way we could evaluate their effects on the important controlled variables such as the recycle ratio and the particle size distribution. Two fault scenarios have been selected for detailed study: one is a binder flowrate deviation causing symptoms in the granulator drum, and another one is the deviation in the outflow from the crusher. In both cases the following items are described to illustrate the operation of our diagnostic system: fault description (that includes the disturbance(s) in the model input variables), deviations and symptoms observed, results generated by the diagnostic procedures (as described in Subsection operator interface. The first example shows how the proposed diagnostic system can cope with a relatively complex localized fault that mainly affects only one operating unit.      The operator can examine the possible causes by opening the tab associated with a possible cause and can choose from the list of suggested preventive actions by clicking on the corresponding button. In  An example of the prediction result is seen in The second example shows how the proposed diagnostic system focuses on the location of the fault in an equipment, but finds causes that may have happened in a higher system level, i.e., on the level of the whole granulator circuit.  “Mechanical failure” “Crusher blockage” “Fail safe trip off”     A diagnostic expert system implemented in G2 is described in this paper. It is able to integrate conventional engineering dynamic models and heuristic operational experience expressed in the form of HAZOP results. The diagnostic “cause-effect” rules and possible actions (suggestions) in its knowledge base are extracted from the results of standard HAZOP analysis. The rule-base of the system is hierarchically structured, driven by the structure of a multi-scale process model that is commonly used for developing models of large-scale process plants. Automatic focusing as well as “what-if” type reasoning for testing hypothetical actions have also been implemented. The diagnostic system has received preliminary testing on a granulator circuit of a fertilizer plant using a simulation test-bed. Further work will be directed to investigate the sensitivity of the diagnostic system on the thresholds used as the symptom detection parameters and the quality of the multi-scale model used for prediction. As well it is important to also consider complementary hazard identification methods to generate the underlying causal analysis. HAZOP simply does not lead to completeness in these studies. Other methods such as failure modes effects analysis (FMEA) can be used to complement existing HAZOP studies. This work has been supported by the Hungarian National Research Fund through grant T042710 and T047198 which is gratefully acknowledged. Also Australian Research Council International Linkage Award LX0348222.